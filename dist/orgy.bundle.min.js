/** 
orgy: Async file and script loader that works both in the browser and in nodejs / io.js. 
Version: 2.0.0 
Built: 2015-03-20 23:02:54
Author: tecfu.com <help@tecfu.com> (http://github.com/tecfu)  
*/
!function(a,b){b["true"]=a,require=function c(a,b,d){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=b[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,c,a,b,d)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(){},{}],2:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],3:[function(a,b){var c=a("./config.js"),d=a("./deferred.js");b.exports=function(a){var b=["then","error"];for(var e in b)if(!a[b[e]])return c.debug("Castable objects require the following properties: "+b[e]);var f={};a.id?f.id=a.id:a.url?f.id=a.url:f.id||(f.id=c.generate_id());var g=d(f),h=function(){g.resolve.call(g,arguments[0])};a.then(h);var i=function(a){g.reject(a)};return a.error(i),g}},{"./config.js":4,"./deferred.js":5}],4:[function(a,b){(function(a){var c={};c.list={},c.i=0,c.settings={debug_mode:1,cwd:!1,mode:function(){return"object"==typeof a&&a+""=="[object process]"?"native":"browser"}(),hooks:{},timeout:5e3},c.config=function(a){if("object"==typeof a)for(var b in a)c.settings[b]=a[b];return c.settings},c.debug=function(b){var d;b instanceof Array&&(d=b.join("\n"));var e=new Error(d);return console.log(e.stack),this.settings.debug_mode,"browser"===c.settings.mode?!1:void a.exit()},c.naive_cloner=function(a){var b={};for(var c in a)for(var d in a[c])if(a[c][d]instanceof Array)b[d]=a[c][d].slice(0);else if("object"==typeof a[c][d])try{b[d]=JSON.parse(JSON.stringify(a[c][d]))}catch(e){console.error(e)}else b[d]=a[c][d];return b},c.generate_id=function(){return(new Date).getTime()+"-"+ ++this.i},b.exports=c}).call(this,a("_process"))},{_process:2}],5:[function(a,b){var c=a("./config.js"),d=a("./deferred.private.js");b.exports=function(a){var b;return a=a||{},a.id&&c.list[a.id]?b=c.list[a.id]:(b=d.factory(a),b=d.activate(b)),b}},{"./config.js":4,"./deferred.private.js":6}],6:[function(a,b){var c=a("./config.js"),d=a("./file_loader.js"),e={};e.factory=function(b){var d=a("./deferred.schema.js"),e=c.naive_cloner([d,b]);return b.id||(e.id=c.generate_id()),e},e.activate=function(a){return c.list[a.id]&&!c.list[a.id].overwritable?(c.debug("Tried to overwrite "+a.id+" without overwrite permissions."),c.list[a.id]):(c.list[a.id]=a,e.auto_timeout.call(a),c.settings.hooks.onActivate&&c.settings.hooks.onActivate(a),a)},e.settle=function(a){return a.timeout_id&&clearTimeout(a.timeout_id),e.set_state(a,1),c.settings.hooks.onSettle&&c.settings.hooks.onSettle(a),a.callbacks.then.hooks.onComplete.train.push(function(b,c,d){a.caboose=d,e.run_train(a,a.callbacks.done,a.caboose,{pause_on_deferred:!1})}),e.run_train(a,a.callbacks.then,a.value,{pause_on_deferred:!0}),a},e.run_train=function(a,b,c,d){var f=c||a.caboose||a.value;for(b.hooks&&b.hooks.onBefore.train.length>0&&e.run_train(a,b.hooks.onBefore,c,{pause_on_deferred:!1});b.train.length>0;){var g=b.train.shift();if(a.execution_history.push(g),f=a.caboose=g.call(a,a.value,a,f),d.pause_on_deferred){if(f&&f.then&&1!==f.settled)return void f.callbacks.resolve.hooks.onComplete.train.push(function(){e.run_train(a,b,f,{pause_on_deferred:!0})});if(f instanceof Array){var h=[];for(var i in f)if(f[i].then&&1!==f[i].settled){h.push(f[i]);var j=function(a,b,c,d){return function(){for(var f in a)if(1!==a[f].settled)return;e.run_train(b,c,d,{pause_on_deferred:!0})}}(h,a,b,c);return void f[i].callbacks.resolve.hooks.onComplete.train.push(j)}}}}b.hooks&&b.hooks.onComplete.train.length>0&&e.run_train(a,b.hooks.onComplete,f,{pause_on_deferred:!1})},e.set_state=function(a,b){a.state=b,(1===b||2===b)&&(a.settled=1),(1===b||2===b)&&e.signal_downstream(a)},e.get_state=function(a){return a.state},e.auto_timeout=function(a){if(this.timeout="undefined"==typeof a?this.timeout:a,!this.type||"timer"!==this.type){if(this.timeout_id&&clearTimeout(this.timeout_id),"undefined"==typeof this.timeout)c.debug(["Auto timeout this.timeout cannot be undefined.",this.id]);else if(-1===this.timeout)return!1;var b=this;this.timeout_id=setTimeout(function(){e.auto_timeout_cb.call(b)},this.timeout)}return!0},e.auto_timeout_cb=function(){if(1!==this.state){var a=[],b=this,d=function(a){return 1!==a.state?a.id:!1};if(c.settings.debug_mode){var f=e.search_obj_recursively(this,"upstream",d);return a.push(b.id+": rejected by auto timeout after "+this.timeout+"ms"),a.push("Cause:"),a.push(f),this.reject.call(this,a)}return this.reject.call(this)}},e.error=function(a){return 2===this.state?a():this.reject_q.push(a),this},e.signal_downstream=function(a){for(var b in a.downstream)if(1===a.downstream[b].settled){if(1!==a.downstream[b].state)continue;c.debug(a.id+" tried to settle promise '"+a.downstream[b].id+"' that has already been settled.")}for(var b in a.downstream)1!==a.downstream[b].settled&&e.receive_signal(a.downstream[b],a.id)},e.search_obj_recursively=function(a,b,d,f){"undefined"==typeof f&&(f=[a.id]);var g;for(var h in a[b])if(g=d(a[b][h]),g!==!1){if(-1!==f.indexOf(g))return c.debug(["Circular condition in recursive search of obj property '"+b+"' of object "+("undefined"!=typeof a.id?"'"+a.id+"'":"")+". Offending value: "+g,function(){return f.push(g),f.join(" [depends on]=> ")}()]);if(f.push(g),a[b][h][b])return e.search_obj_recursively(a[b][h],b,d,f);break}return f},e.convert_to_promise=function(b,d){if(b.id=b.id||d.id,b.id||("timer"===b.type?b.id="timer-"+b.timeout+"-"+ ++c.i:"string"==typeof b.url&&(b.id=b.url.split("/").pop(),-1!==b.id.search(".js")&&(b.id=b.id.split("."),b.id.pop(),b.id=b.id.join(".")))),c.list[b.id]&&"timer"!==b.type){if(!b.resolver)return c.list[b.id];c.debug(["You can't set a resolver on a queue that has already been declared. You can only reference the original.","Detected re-init of '"+b.id+"'.","Attempted:",b,"Existing:",c.list[b.id]])}var f;switch(!0){case"event"===b.type:f=e.wrap_event(b);break;case"queue"===b.type:var g=a("./queue.js");f=g(b.dependencies,b);break;case"function"==typeof b.then:switch(!0){case"string"==typeof b.id:console.warn("'"+b.id+"': did not exist. Auto creating new deferred."),f=e.deferred({id:b.id}),b.then&&b.then(function(a){f.resolve(a)});break;case"function"==typeof b.promise:f=b.scope?b.promise.call(b.scope):b.promise();break;case b.then:f=b}if("object"!=typeof f||!f.then)return c.debug("Dependency labeled as a promise did not return a promise.",b);break;case"timer"===b.type:f=e.wrap_timer(b);break;default:b.type=b.type||"default",d.parent&&d.parent.cwd&&(b.cwd=d.parent.cwd),f=e.wrap_xhr(b)}return c.list[b.id]=f,f},e.wrap_event=function(b){var c=a("./deferred.js"),d=c({id:b.id});if("undefined"!=typeof document&&"undefined"!=typeof window)if("function"!=typeof $){var e="window and document based events depend on jQuery";d.reject(e)}else switch(!0){case"ready"===b.id||"DOMContentLoaded"===b.id:$(document).ready(function(){d.resolve(1)});break;case"load"===b.id:$(window).load(function(){d.resolve(1)});break;default:$(document).on(b.id,"body",function(){d.resolve(1)})}return d},e.wrap_timer=function(b){var c=a("./deferred.js"),d=c();return function(a){var c=(new Date).getTime();setTimeout(function(){var d=(new Date).getTime();a.resolve({start:c,end:d,elapsed:d-c,timeout:b.timeout})},b.timeout)}(d),d},e.wrap_xhr=function(b){var e=a("./deferred.js"),f=["id","url"];for(var g in f)if(!b[f[g]])return c.debug(["File requests converted to promises require: "+f[g],"Make sure you weren't expecting dependency to already have been resolved upstream.",b]);if(c.list[b.id])return c.list[b.id];var h=e(b);return"undefined"!=typeof d[c.settings.mode][b.type]?d[c.settings.mode][b.type](b.url,h,b):d[c.settings.mode]["default"](b.url,h,b),h},e.receive_signal=function(a,b){if(1!==a.halt_resolution){if(b!==a.id&&!a.upstream[b])return c.debug(b+" can't signal "+a.id+" because not in upstream.");var d=1;for(var e in a.upstream)if(1!==a.upstream[e].state){d=a.upstream[e].state;break}if(1===d){var f=[];for(var e in a.dependencies)f.push(a.dependencies[e].value);a.resolve.call(a,f)}if(2===d){var g=[a.id+" dependency '"+a.upstream[e].id+"' was rejected.",a.upstream[e].arguments];a.reject.apply(a,g)}}},b.exports=e},{"./config.js":4,"./deferred.js":5,"./deferred.schema.js":7,"./file_loader.js":8,"./queue.js":9}],7:[function(a,b){var c=a("./config.js"),d={};d.is_orgy=!0,d.id=null,d.settled=0,d.state=0,d.value=[],d.caboose=null,d.model="deferred",d.done_fired=0,d.timeout_id=null,d.callback_states={resolve:0,then:0,done:0,reject:0},d.callbacks=function(){var a={};for(var b in d.callback_states)a[b]={train:[],hooks:{onBefore:{train:[]},onComplete:{train:[]}}};return a}(),d.downstream={},d.execution_history=[],d.overwritable=0,d.timeout=c.settings.timeout,d.remote=1,d.list=1,d.resolve=function(b){var d=a("./deferred.private.js");if(1===this.settled&&c.debug([this.id+" can't resolve.","Only unsettled deferreds are resolvable."]),d.set_state(this,-1),this.value=b,this.resolver_fired||"function"!=typeof this.resolver)this.resolver_fired=1,this.callbacks.resolve.hooks.onComplete.train.unshift(function(){d.settle(this)});else{this.resolver_fired=1;try{this.callbacks.resolve.train.push(function(){this.resolver(b,this)})}catch(e){}}return d.run_train(this,this.callbacks.resolve,this.value,{pause_on_deferred:!1}),this},d.reject=function(b){var d=a("./deferred.private.js");b instanceof Array||(b=[b]);var e="Rejected "+this.model+": '"+this.id+"'.";return c.settings.debug_mode?(b.unshift(e),c.debug(b,this)):(e+="\n Turn debug mode on for more info.",console.log(e)),this.timeout_id&&clearTimeout(this.timeout_id),d.set_state(this,2),d.run_train(this,this.callbacks.reject,b,{pause_on_deferred:!1}),this},d.then=function(a,b){switch(!0){case 2===this.state:break;case 1===this.done_fired:return c.debug(this.id+" can't attach .then() because .done() has already fired, and that means the execution chain is complete.");default:this.callbacks.then.train.push(a),"function"==typeof b&&this.callbacks.reject.train.push(b),1!==this.settled||1!==this.state||this.done_fired||this.run_train(this,this.callbacks.then,this.caboose,{pause_on_deferred:!0})}return this},d.done=function(b,d){var e=a("./deferred.private.js");if(0!==this.callbacks.done.train.length||0!==this.done_fired)return c.debug("done() can only be called once.");if("function"!=typeof b)return c.debug("done() must be passed a function.");var f=function(a,c,d){c.done_fired=1,b(a,c,d)};this.callbacks.done.train.push(f),"function"==typeof d&&this.callbacks.reject.hooks.onComplete.train.push(d),1===this.settled&&(1===this.state?e.run_train(this,this.callbacks.done,this.caboose,{pause_on_deferred:!1}):e.run_train(this,this.callbacks.reject,this.caboose,{pause_on_deferred:!1}))},b.exports=d},{"./config.js":4,"./deferred.private.js":6}],8:[function(a,b){(function(c){var d=a("./config.js"),e={},f={};e.browser={},e["native"]={},f["native"]={},e.browser.css=function(a,b){var c=document.getElementsByTagName("head")[0]||document.documentElement,d=document.createElement("link");d.setAttribute("href",a),d.setAttribute("type","text/css"),d.setAttribute("rel","stylesheet"),d.onload?(!function(a){a.onload=a.onreadystatechange=function(b,c){c.resolve(a)},a.onerror=function(a,b){b.reject("Failed to load path: "+a)}}(d,a,b),c.appendChild(d)):(c.appendChild(d),console.warn("No onload available for link tag, autoresolving."),b.resolve(d))},e.browser.script=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.setAttribute("src",a),function(a,b,c){a.onload=a.onreadystatechange=function(){("boolean"!=typeof c.autoresolve||c.autoresolve===!0)&&c.resolve("undefined"!=typeof a.value?a.value:a)},a.onerror=function(){c.reject("Error loading: "+b)}}(c,a,b),this.head.appendChild(c)},e.browser.html=function(a,b){this["default"](a,b)},e.browser["default"]=function(a,b,c){var d,f=new XMLHttpRequest;f.open("GET",a,!0),function(a,b){f.onreadystatechange=function(){if(4===f.readyState)if(200===f.status){if(d=f.responseText,c.type&&"json"===c.type)try{d=JSON.parse(d)}catch(g){e.debug(["Could not decode JSON",a,d],b)}b.resolve(d)}else b.reject("Error loading: "+a)}}(a,b),f.send(null)},e["native"].css=function(a,b){e.browser.css(a,b)},e["native"].script=function(b,e){if("."===b[0]){var g=f["native"].prepare_path(b,e),h=a(g.path);g.dirchanged&&c.chdir(g.owd),("boolean"!=typeof e.autoresolve||e.autoresolve===!0)&&e.resolve(h)}else d.settings.debug_mode?f["native"].get(b,e,function(b){var c=a("vm");h=c.runInThisContext(b),e.resolve(h)}):(_,d.debug("Set config.debug_mode=1 to run remote scripts outside of debug mode."))},e["native"].html=function(a,b){e["native"]["default"](a,b)},e["native"]["default"]=function(a,b){f["native"].get(a,b,function(a){b.resolve(a)})},f["native"].get=function(b,d,e){if("."===b[0]){var g=f["native"].prepare_path(b,d),h=a("fs");h.readFile(g.path,function(a,b){if(a)throw a;e(b)}),g.dirchanged&&c.chdir(g.owd)}else{var i=a("http");i.get({path:b},function(a){var b="";a.on("data",function(a){b+=a}),a.on("end",function(){e(b)})})}},f["native"].prepare_path=function(a,b){var e=c.cwd(),f=b.cwd?b.cwd:d.settings.cwd?d.settings.cwd:!1,g=!1;return f?(c.chdir(f),g=!0):f=e,{owd:e,path:f+"/"+a,dirchanged:g}},b.exports=e}).call(this,a("_process"))},{"./config.js":4,_process:2,fs:1,http:1,vm:1}],9:[function(a,b){var c=a("./config.js"),d=a("./queue.private.js");b.exports=function(a,b){var e;if(!(a instanceof Array))return c.debug("Queue dependencies must be an array.");if(b=b||{},c.list[b.id]){if(e=c.list[b.id],"queue"!==e.model)b.overwritable=1,e=d.upgrade(e,b,a);else{for(var f in b)e[f]=b[f];a.length>0&&d.tpl.add.call(e,a)}e.halt_resolution="undefined"!=typeof b.halt_resolution?b.halt_resolution:0}else{var e=d.factory(b);e=d.activate(e,b,a)}return e}},{"./config.js":4,"./queue.private.js":10}],10:[function(a,b){var c=a("./config.js"),d=a("./queue.schema.js"),e=a("./deferred.private.js"),f=Object.create(e,{});f.factory=function(a){var b=c.naive_cloner([d,a]);return a.id||(b.id=c.generate_id()),b},f.activate=function(a,b,c){a=e.activate(a),a.state=-1;var f=this;return setTimeout(function(){if(a.state=0,d.add.call(a,c),f.receive_signal(a,a.id),a.assign)for(var b in a.assign)f.assign(a.assign[b],[a],!0)},1),a},f.upgrade=function(a,b,e){if(0!==a.settled||"promise"!==a.model&&"deferred"!==a.model)return c.debug("Can only upgrade unsettled promise or deferred into a queue.");var f=c.naive_cloner([d,b]);for(var g in f)a[g]=f[g];return a=this.activate(a,b,e)},b.exports=f},{"./config.js":4,"./deferred.private.js":6,"./queue.schema.js":11}],11:[function(a,b){var c=a("./config.js"),d=a("./deferred.schema.js"),e=Object.create(d,{});e.model="queue",e.resolver_fired=0,e.halt_resolution=0,e.upstream={},e.dependencies=[],e.add=function(b){var d=a("./queue.private.js");try{if(0===b.length)return this.upstream}catch(e){c.debug(e)}if(0!==this.state)return c.debug(["Cannot add dependency list to queue id:'"+this.id+"'. Queue settled/in the process of being settled."],b,this);for(var f in b){switch(!0){case"object"==typeof c.list[b[f].id]:b[f]=c.list[b[f].id];break;case"object"==typeof b[f]&&!b[f].is_orgy:b[f]=d.convert_to_promise(b[f],{parent:this});break;case"function"==typeof b[f].then:break;default:console.error("Object could not be converted to promise."),console.error(b[f]);continue}for(var g in this.downstream)if(g===b[f].id)return c.debug(["Error adding upstream dependency '"+b[f].id+"' to queue '"+this.id+"'.\n Promise object for '"+b[f].id+"' is scheduled to resolve downstream from queue '"+this.id+"' so it can't be added upstream."],this);this.upstream[b[f].id]=b[f],b[f].downstream[this.id]=this,this.dependencies.push(b[f])}return this.upstream},e.remove=function(a){if(0!==this.state)return c.debug("Cannot remove list from queue id:'"+this.id+"'. Queue settled/in the process of being settled.");for(var b in a)this.upstream[a[b].id]&&(delete this.upstream[a[b].id],delete a[b].downstream[this.id])},e.reset=function(b){var d=a("./deferred.private.js");return 1!==this.settled||1!==this.state?c.debug("Can only reset a queue settled without errors."):(b=b||{},this.settled=0,this.state=0,this.resolver_fired=0,this.done_fired=0,this.timeout_id&&clearTimeout(this.timeout_id),this.downstream={},this.dependencies=[],d.auto_timeout.call(this,b.timeout),this)},e.check_self=function(){var b=a("./deferred.private.js");return b.receive_signal(this,this.id),this.state},b.exports=e},{"./config.js":4,"./deferred.private.js":6,"./deferred.schema.js":7,"./queue.private.js":10}],orgy:[function(a,b){var c=a("./deferred.js"),d=a("./queue.js"),e=a("./cast.js"),f=a("./config.js");b.exports={define:function(a,b,e){var g;if(e=e||{},e.dependencies=e.dependencies||null,e.resolver=e.resolver||null,"string"!=typeof a&&f.debug("Must set id when defining an instance."),f.list[a]&&1===f.list[a].settled)return f.debug("Can't define "+a+". Already resolved.");if(e.id=a,null!==e.dependencies&&e.dependencies instanceof Array){var h=e.dependencies;delete e.dependencies,g=d(h,e)}else g=c(e),null!==e.resolver||"boolean"==typeof e.autoresolve&&e.autoresolve!==!0||(g.autoresolve=!1,g.resolve(b));return g},get:function(a){return f.list[a]?f.list[a]:null},assign:function(a,b,c){c="boolean"==typeof c?c:1;var e,g;switch(!0){case"object"==typeof a&&"function"==typeof a.then:e=a.id;break;case"string"==typeof a:e=a;break;default:return f.debug("Assign target must be a queue object or the id of a queue.",this)}if(f.list[e]&&"queue"===f.list[e].model)g=f.list[e],c?g.add(b):g.remove(b);else{if(!c)return f.debug("Cannot remove dependencies from a queue that does not exist.",this);g=d(b,{id:e})}return g},deferred:c,queue:d,cast:e,config:f.config}},{"./cast.js":3,"./config.js":4,"./deferred.js":5,"./queue.js":9}]},{},[])}({},function(){return this}());