/** 
orgy: Async file and script loader that works both in the browser and in nodejs / io.js. 
Version: 2.0.5 
Built: 2015-06-28 05:00:23
Author: tecfu <help@tecfu.com> (http://github.com/tecfu)  
*/
!function(a,b){b["true"]=a,require=function c(a,b,d){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=b[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,c,a,b,d)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(){},{}],2:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],3:[function(a,b){b.exports=function(a){return a.cast=function(b){var c=["then","error","id"];for(var d in c)if(!b.hasOwnProperty(c[d]))return a["private"].config.debug("Cast method missing property '"+c[d]+"'");var e={};if(e.id=b.id,a["private"].config.list[e.id])return a["private"].config.debug("Id "+e.id+" conflicts with existing id.");var f=a.deferred(e),g=function(){f.resolve.call(f,arguments[0])};b.then(g);var h=function(a){f.reject(a)};return b.error(h),f},a}},{}],4:[function(a,b){(function(a){b.exports=function(b){var c={};return c.list={},c.i=0,c.settings={debug_mode:1,cwd:!1,mode:function(){return"object"==typeof a&&a+""=="[object process]"?"native":"browser"}(),hooks:{},timeout:5e3},b.config=function(a){if("object"==typeof a)for(var b in a)c.settings[b]=a[b];return c.settings},c.debug=function(b){var d=b instanceof Array?b.join("\n"):[b],e=new Error(d);return console.log(e.stack),this.settings.debug_mode,"browser"===c.settings.mode?!1:void a.exit()},c.naive_cloner=function(a,b){function c(a){var b={};for(var c in a)for(var d in a[c])if(a[c][d]instanceof Array)b[d]=a[c][d].slice(0);else if("object"==typeof a[c][d])try{b[d]=JSON.parse(JSON.stringify(a[c][d]))}catch(e){console.error(e)}else b[d]=a[c][d];return b}var d=c(a),e=c(b),f=Object.create(d);for(var g in e)f[g]=e[g];return f},c.generate_id=function(){return(new Date).getTime()+"-"+ ++this.i},b["private"].config=c,b}}).call(this,a("_process"))},{_process:2}],5:[function(a,b){b.exports=function(a){var b={};b.activate=function(c){return c.id||(c.id=a["private"].config.generate_id()),a["private"].config.list[c.id]&&!a["private"].config.list[c.id].overwritable?(a["private"].config.debug("Tried illegal overwrite of "+c.id+"."),a["private"].config.list[c.id]):(a["private"].config.list[c.id]=c,b.auto_timeout.call(c),a["private"].config.settings.hooks.onActivate&&a["private"].config.settings.hooks.onActivate(c),c)},b.settle=function(c){return c.timeout_id&&clearTimeout(c.timeout_id),b.set_state(c,1),a["private"].config.settings.hooks.onSettle&&a["private"].config.settings.hooks.onSettle(c),c.callbacks.then.hooks.onComplete.train.push(function(a,d,e){c.caboose=e,b.run_train(c,c.callbacks.done,c.caboose,{pause_on_deferred:!1})}),b.run_train(c,c.callbacks.then,c.value,{pause_on_deferred:!0}),c},b.run_train=function(a,c,d,e){var f=d||a.caboose||a.value;for(c.hooks&&c.hooks.onBefore.train.length>0&&b.run_train(a,c.hooks.onBefore,d,{pause_on_deferred:!1});c.train.length>0;){var g=c.train.shift();if(a.execution_history.push(g),f=a.caboose=g.call(a,a.value,a,f),e.pause_on_deferred){if(f&&f.then&&1!==f.settled)return void f.callbacks.resolve.hooks.onComplete.train.push(function(){b.run_train(a,c,f,{pause_on_deferred:!0})});if(f instanceof Array){var h=[];for(var i in f)if(f[i].then&&1!==f[i].settled){h.push(f[i]);var j=function(a,c,d,e){return function(){for(var f in a)if(1!==a[f].settled)return;b.run_train(c,d,e,{pause_on_deferred:!0})}}(h,a,c,d);return void f[i].callbacks.resolve.hooks.onComplete.train.push(j)}}}}c.hooks&&c.hooks.onComplete.train.length>0&&b.run_train(a,c.hooks.onComplete,f,{pause_on_deferred:!1})},b.set_state=function(a,c){a.state=c,(1===c||2===c)&&(a.settled=1),(1===c||2===c)&&b.signal_downstream(a)},b.get_state=function(a){return a.state},b.auto_timeout=function(){if(this.timeout="undefined"!=typeof this.timeout?this.timeout:a["private"].config.settings.timeout,!this.type||"timer"!==this.type){if(this.timeout_id&&clearTimeout(this.timeout_id),"undefined"==typeof this.timeout)a["private"].config.debug(["Auto timeout this.timeout cannot be undefined.",this.id]);else if(-1===this.timeout)return!1;var c=this;this.timeout_id=setTimeout(function(){b.auto_timeout_cb.call(c)},this.timeout)}return!0},b.auto_timeout_cb=function(){if(1!==this.state){var c=[],d=this,e=function(a){return 1!==a.state?a.id:!1};if(a["private"].config.settings.debug_mode){var f=b.search_obj_recursively(this,"upstream",e);return c.push(d.id+": rejected by auto timeout after "+this.timeout+"ms"),c.push("Cause:"),c.push(f),this.reject.call(this,c)}return this.reject.call(this)}},b.error=function(a){return 2===this.state?a():this.reject_q.push(a),this},b.signal_downstream=function(c){for(var d in c.downstream)if(1===c.downstream[d].settled){if(1!==c.downstream[d].state)continue;a["private"].config.debug(c.id+" tried to settle promise '"+c.downstream[d].id+"' that has already been settled.")}for(var d in c.downstream)1!==c.downstream[d].settled&&b.receive_signal(c.downstream[d],c.id)},b.search_obj_recursively=function(c,d,e,f){"undefined"==typeof f&&(f=[c.id]);var g;for(var h in c[d])if(g=e(c[d][h]),g!==!1){if(-1!==f.indexOf(g))return a["private"].config.debug(["Circular condition in recursive search of obj property '"+d+"' of object "+("undefined"!=typeof c.id?"'"+c.id+"'":"")+". Offending value: "+g,function(){return f.push(g),f.join(" [depends on]=> ")}()]);if(f.push(g),c[d][h][d])return b.search_obj_recursively(c[d][h],d,e,f);break}return f},b.convert_to_promise=function(c,d){if(c.id=c.id||d.id,c.id||("timer"===c.type?c.id="timer-"+c.timeout+"-"+ ++a["private"].config.i:"string"==typeof c.url&&(c.id=c.url.split("/").pop(),-1!==c.id.search(".js")&&(c.id=c.id.split("."),c.id.pop(),c.id=c.id.join(".")))),a["private"].config.list[c.id]&&"timer"!==c.type){if(!c.resolver)return a["private"].config.list[c.id];a["private"].config.debug(["You can't set a resolver on a queue that has already been declared. You can only reference the original.","Detected re-init of '"+c.id+"'.","Attempted:",c,"Existing:",a["private"].config.list[c.id]])}var e;switch(!0){case"event"===c.type:e=b.wrap_event(c);break;case"queue"===c.type:e=a.queue(c.dependencies,c);break;case"function"==typeof c.then:switch(!0){case"string"==typeof c.id:console.warn("'"+c.id+"': did not exist. Auto creating new deferred."),e=b.deferred({id:c.id}),c.then&&c.then(function(a){e.resolve(a)});break;case"function"==typeof c.promise:e=c.scope?c.promise.call(c.scope):c.promise();break;case c.then:e=c}if("object"!=typeof e||!e.then)return a["private"].config.debug("Dependency labeled as a promise did not return a promise.",c);break;case"timer"===c.type:e=b.wrap_timer(c);break;default:c.type=c.type||"default",d.parent&&d.parent.cwd&&(c.cwd=d.parent.cwd),e=b.wrap_xhr(c)}return a["private"].config.list[c.id]=e,e},b.wrap_event=function(b){var c=a.deferred({id:b.id});if("undefined"!=typeof document&&"undefined"!=typeof window)if("function"!=typeof $){var d="window and document based events depend on jQuery";c.reject(d)}else switch(!0){case"ready"===b.id||"DOMContentLoaded"===b.id:$(document).ready(function(){c.resolve(1)});break;case"load"===b.id:$(window).load(function(){c.resolve(1)});break;default:$(document).on(b.id,"body",function(){c.resolve(1)})}return c},b.wrap_timer=function(b){var c=a.deferred();return function(a){var c=(new Date).getTime();setTimeout(function(){var d=(new Date).getTime();a.resolve({start:c,end:d,elapsed:d-c,timeout:b.timeout})},b.timeout)}(c),c},b.wrap_xhr=function(b){var c=["id","url"];for(var d in c)if(!b[c[d]])return a["private"].config.debug(["File requests converted to promises require: "+c[d],"Make sure you weren't expecting dependency to already have been resolved upstream.",b]);if(a["private"].config.list[b.id])return a["private"].config.list[b.id];var e=a.deferred(b);return"undefined"!=typeof a.file_loader[a["private"].config.settings.mode][b.type]?a.file_loader[a["private"].config.settings.mode][b.type](b.url,e,b):a.file_loader[a["private"].config.settings.mode]["default"](b.url,e,b),e},b.receive_signal=function(b,c){if(1!==b.halt_resolution){var d;if(c!==b.id&&!b.upstream[c])return a["private"].config.debug(c+" can't signal "+b.id+" because not in upstream.");d=1;for(var e in b.upstream)if(1!==b.upstream[e].state){d=b.upstream[e].state;break}if(1===d){var f=[];for(var e in b.dependencies)f.push(b.dependencies[e].value);b.resolve.call(b,f)}if(2===d){var g=[b.id+" dependency '"+b.upstream[e].id+"' was rejected.",b.upstream[e].arguments];b.reject.apply(b,g)}}};var c={};return c.is_orgy=!0,c.id=null,c.settled=0,c.state=0,c.value=[],c.caboose=null,c.model="deferred",c.done_fired=0,c.timeout_id=null,c.callback_states={resolve:0,then:0,done:0,reject:0},c.callbacks=function(){var a={};for(var b in c.callback_states)a[b]={train:[],hooks:{onBefore:{train:[]},onComplete:{train:[]}}};return a}(),c.downstream={},c.execution_history=[],c.overwritable=0,c.remote=1,c.list=1,c.resolve=function(c){if(1===this.settled&&a["private"].config.debug([this.id+" can't resolve.","Only unsettled deferreds are resolvable."]),b.set_state(this,-1),this.value=c,this.resolver_fired||"function"!=typeof this.resolver)this.resolver_fired=1,this.callbacks.resolve.hooks.onComplete.train.unshift(function(){b.settle(this)});else{this.resolver_fired=1;try{this.callbacks.resolve.train.push(function(){this.resolver(c,this)})}catch(d){a["private"].config.debug(d)}}return b.run_train(this,this.callbacks.resolve,this.value,{pause_on_deferred:!1}),this},c.reject=function(c){c instanceof Array||(c=[c]);var d="Rejected "+this.model+": '"+this.id+"'.";return a["private"].config.settings.debug_mode?(c.unshift(d),a["private"].config.debug(c,this)):(d+=" Turn on debug mode for more info.",console.warn(d)),this.timeout_id&&clearTimeout(this.timeout_id),b.set_state(this,2),b.run_train(this,this.callbacks.reject,c,{pause_on_deferred:!1}),this},c.then=function(c,d){switch(!0){case 2===this.state:"function"==typeof d&&this.callbacks.reject.train.push(d);break;case 1===this.done_fired:return a["private"].config.debug(this.id+" can't attach .then() because .done() has already fired, and that means the execution chain is complete.");default:this.callbacks.then.train.push(c),"function"==typeof d&&this.callbacks.reject.train.push(d),1!==this.settled||1!==this.state||this.done_fired||b.run_train(this,this.callbacks.then,this.caboose,{pause_on_deferred:!0})}return this},c.done=function(c,d){if(0!==this.callbacks.done.train.length||0!==this.done_fired)return a["private"].config.debug("done() can only be called once.");if("function"!=typeof c)return a["private"].config.debug("done() must be passed a function.");var e=function(a,b,d){b.done_fired=1,c(a,b,d)};return this.callbacks.done.train.push(e),"function"==typeof d&&this.callbacks.reject.hooks.onComplete.train.push(d),1===this.settled&&(1===this.state?b.run_train(this,this.callbacks.done,this.caboose,{pause_on_deferred:!1}):b.run_train(this,this.callbacks.reject,this.caboose,{pause_on_deferred:!1})),this},c._btrc=function(a){return this.backtrace=a,this},a.deferred=function(d){var e;return d=d||{},d.id&&a["private"].config.list[d.id]?e=a["private"].config.list[d.id]:(e=a["private"].config.naive_cloner([c],[d]),e=b.activate(e)),e},b["public"]=c,a["private"].deferred=b,a}},{}],6:[function(a,b){b.exports=function(b){var c={},d={};return c.browser={},c["native"]={},d["native"]={},c.browser.css=function(a,b){var c=document.getElementsByTagName("head")[0]||document.documentElement,d=document.createElement("link");d.setAttribute("href",a),d.setAttribute("type","text/css"),d.setAttribute("rel","stylesheet"),d.onload?(!function(a){a.onload=a.onreadystatechange=function(b,c){c.resolve(a)},a.onerror=function(a,b){b.reject("Failed to load path: "+a)}}(d,a,b),c.appendChild(d)):(c.appendChild(d),console.warn("No onload available for link tag, autoresolving."),b.resolve(d))},c.browser.script=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.setAttribute("src",a),function(a,b,c){a.onload=a.onreadystatechange=function(){("boolean"!=typeof c.autoresolve||c.autoresolve===!0)&&c.resolve("undefined"!=typeof a.value?a.value:a)},a.onerror=function(){c.reject("Error loading: "+b)}}(c,a,b),this.head.appendChild(c)},c.browser.html=function(a,b,c){this["default"](a,b,c)},c.browser["default"]=function(a,b,d){var e,f=new XMLHttpRequest;f.open("GET",a,!0),function(a,b){f.onreadystatechange=function(){if(4===f.readyState)if(200===f.status){if(e=f.responseText,d.type&&"json"===d.type)try{e=JSON.parse(e)}catch(g){c.debug(["Could not decode JSON",a,e],b)}b.resolve(e)}else b.reject("Error loading: "+a)}}(a,b),f.send(null)},c["native"].css=function(a,b){c.browser.css(a,b)},c["native"].script=function(c,e){if("."===c[0]){c=d["native"].prepare_path(c,e);var f=a(c);("boolean"!=typeof e.autoresolve||e.autoresolve===!0)&&e.resolve(f)}else b["private"].config.settings.debug_mode?d["native"].get(c,e,function(b){var c=a("vm");f=c.runInThisContext(b),e.resolve(f)}):b["private"].config.debug("Set config.debug_mode=1 to run remote scripts outside of debug mode.")},c["native"].html=function(a,b){c["native"]["default"](a,b)},c["native"]["default"]=function(a,b){!function(b){d["native"].get(a,b,function(a){"json"===b.type&&(a=JSON.parse(a)),b.resolve(a)})}(b)},d["native"].get=function(b,c,e){if(b=d["native"].prepare_path(b),"."===b[0]){var f=a("fs");f.readFile(b,"utf-8",function(a,b){if(a)throw a;e(b)})}else{var g=a("request");g(b,function(a,b,c){if(a||200!==b.statusCode)throw a;e(c)})}},d["native"].prepare_path=function(a){return a="/"!==a[0]&&"."!==a[0]&&0!==a[0].indexOf("http")?"./"+a:a},b.file_loader=c,b["private"].file_loader=d,b}},{fs:1,request:1,vm:1}],7:[function(a,b){b.exports=function(a){var b={};b.activate=function(b,d,e){b=a["private"].deferred.activate(b),b.state=-1;var f=this;return setTimeout(function(){if(b.state=0,c.add.call(b,e),a["private"].deferred.receive_signal(b,b.id),b.assign)for(var d in b.assign)f.assign(b.assign[d],[b],!0)},1),b},b.upgrade=function(b,d,e){if(0!==b.settled||"promise"!==b.model&&"deferred"!==b.model)return a["private"].config.debug("Can only upgrade unsettled promise or deferred into a queue.");var f=a["private"].config.naive_cloner([c],[d]);for(var g in f)b[g]=f[g];return b=this.activate(b,d,e)};var c={};return c.model="queue",c.resolver_fired=0,c.halt_resolution=0,c.upstream={},c.dependencies=[],c.add=function(b){try{if(0===b.length)return this.upstream}catch(c){a["private"].config.debug(c)}if(0!==this.state)return a["private"].config.debug(["Cannot add dependency list to queue id:'"+this.id+"'. Queue settled/in the process of being settled."],b,this);for(var d in b){switch(!0){case"object"==typeof a["private"].config.list[b[d].id]:b[d]=a["private"].config.list[b[d].id];break;case"object"==typeof b[d]&&!b[d].is_orgy:b[d]=a["private"].deferred.convert_to_promise(b[d],{parent:this});break;case"function"==typeof b[d].then:break;default:a["private"].config.debug(["Object could not be converted to promise.",b[d]]);continue}for(var e in this.downstream)if(e===b[d].id)return a["private"].config.debug(["Error adding upstream dependency '"+b[d].id+"' to queue '"+this.id+"'.\n Promise object for '"+b[d].id+"' is scheduled to resolve downstream from queue '"+this.id+"' so it can't be added upstream."],this);this.upstream[b[d].id]=b[d],b[d].downstream[this.id]=this,this.dependencies.push(b[d])}return this.upstream},c.remove=function(b){if(0!==this.state)return a["private"].config.debug("Cannot remove list from queue id:'"+this.id+"'. Queue settled/in the process of being settled.");for(var c in b)this.upstream[b[c].id]&&(delete this.upstream[b[c].id],delete b[c].downstream[this.id])},c.reset=function(b){return 1!==this.settled||1!==this.state?a["private"].config.debug("Can only reset a queue settled without errors."):(b=b||{},this.settled=0,this.state=0,this.resolver_fired=0,this.done_fired=0,this.timeout_id&&clearTimeout(this.timeout_id),this.downstream={},this.dependencies=[],a["private"].deferred.auto_timeout.call(this,b.timeout),this)},c.check_self=function(){return a["private"].deferred.receive_signal(this,this.id),this.state},a.queue=function(d,e){var f;return d instanceof Array?(e=e||{},a["private"].config.list[e.id]?(f=a["private"].config.list[e.id],"queue"!==f.model?(e.overwritable=1,f=b.upgrade(f,e,d)):(e.forEach(function(a,b){f[b]=a}),d.length>0&&b.tpl.add.call(f,d)),f.halt_resolution="undefined"!=typeof e.halt_resolution?e.halt_resolution:0):(f=a["private"].config.naive_cloner([a["private"].deferred["public"],c],[e]),f=b.activate(f,e,d)),f):a["private"].config.debug("Queue dependencies must be an array.")},a["private"].queue=b,a}},{}],orgy:[function(a,b){var c=Object.create({"private":{}});a("./config.js")(c),a("./file_loader.js")(c),a("./deferred.js")(c),a("./queue.js")(c),a("./cast.js")(c),c.define=function(a,b,d){var e;if(d=d||{},d.dependencies=d.dependencies||null,d.resolver=d.resolver||null,"string"!=typeof a&&c["private"].config.debug("Must set id when defining an instance."),c["private"].config.list[a]&&1===c["private"].config.list[a].settled)return c["private"].config.debug("Can't define "+a+". Already resolved.");if(d.id=a,null!==d.dependencies&&d.dependencies instanceof Array){var f=d.dependencies;delete d.dependencies,e=c.queue(f,d)}else e=c.deferred(d),null!==d.resolver||"boolean"==typeof d.autoresolve&&d.autoresolve!==!0||(e.autoresolve=!1,e.resolve(b));return e},c.get=function(a){return c["private"].config.list[a]?c["private"].config.list[a]:null},c.assign=function(a,b,d){d="boolean"==typeof d?d:1;var e,f;switch(!0){case"object"==typeof a&&"function"==typeof a.then:e=a.id;break;case"string"==typeof a:e=a;break;default:return c["private"].config.debug("Assign target must be a queue object or the id of a queue.",this)}if(c["private"].config.list[e]&&"queue"===c["private"].config.list[e].model)f=c["private"].config.list[e],d?f.add(b):f.remove(b);else{if(!d)return c["private"].config.debug("Cannot remove dependencies from a queue that does not exist.",this);f=c.queue(b,{id:e})}return f},b.exports=c},{"./cast.js":3,"./config.js":4,"./deferred.js":5,"./file_loader.js":6,"./queue.js":7}]},{},[])}({},function(){return this}());