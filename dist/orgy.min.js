/** 
orgy: Async file and script loader that works both in the browser and in nodejs / io.js. 
Version: 1.8.0 
Built: 2015-03-09 02:55:08
Author: tecfu.com <help@tecfu.com> (http://github.com/tecfu)  
*/
!function(a,b){b["true"]=a,function c(a,b,d){function e(g,h){if(!b[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=b[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,c,a,b,d)}return b[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){function c(){if(!g){g=!0;for(var a,b=f.length;b;){a=f,f=[];for(var c=-1;++c<b;)a[c]();b=f.length}g=!1}}function d(){}var e=b.exports={},f=[],g=!1;e.nextTick=function(a){f.push(a),g||setTimeout(c,0)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],2:[function(a,b){"use strict";var c=a("./main.js"),d=a("./deferred.js"),e={};e.cast=function(a){var b=["then","error"];for(var e in b)if(!a[b[e]])return c.debug("Castable objects require the following properties: "+b[e]);var f={};if(a.id)f.id=a.id;else if(a.url)f.id=a.url;else{var g=c.get_backtrace_info("cast");f.id||(f.id=g.origin+"-"+ ++c[e])}var h=d(f),i=function(){h.resolve.call(h,arguments[0])};a.then(i);var j=function(a){var b=function(){return a.apply(this,arguments)};return b.toString=function(){return a.toString()},b}(function(a){h.reject(a)});return a.error(j),h},b.exports=e},{"./deferred.js":3,"./main.js":6}],3:[function(a,b){"use strict";var c=a("lodash"),d=a("./main.js"),e=d.config(),f=a("./queue.js"),g=a("./deferred.tpl.js"),h=a("./file_loader.js"),j={},k={};j.deferred=function(a){var b;return a=a||{},a.id&&d.list[a.id]?b=d.list[a.id]:(b=k.factory(a),b=k.activate(b)),b},k.factory=function(a){var b=c.assign({},[g,a]);return b.backtrace||(b.backtrace=d.get_backtrace_info("deferred")),a.id||(b.id=b.backtrace.origin+"-"+ ++d[i]),b},k.settle=function(a){return a.timeout_id&&clearTimeout(a.timeout_id),k.set_state(a,1),e.hooks.onSettle&&e.hooks.onSettle(a),a.callbacks.then.hooks.onComplete.train.push(function(b,c,d){a.caboose=d,k.run_train(a,a.callbacks.done,a.caboose,{pause_on_deferred:!1})}),k.run_train(a,a.callbacks.then,a.value,{pause_on_deferred:!0}),a},k.run_train=function(a,b,c,d){var e=c||a.caboose||a.value;for(b.hooks&&b.hooks.onBefore.train.length>0&&k.run_train(a,b.hooks.onBefore,c,{pause_on_deferred:!1});b.train.length>0;){var f=b.train.shift();if(a.execution_history.push(f),e=a.caboose=f.call(a,a.value,a,e),d.pause_on_deferred){if(e&&e.then&&1!==e.settled)return void e.callbacks.resolve.hooks.onComplete.train.push(function(){k.run_train(a,b,e,{pause_on_deferred:!0})});if(e instanceof Array){var g=[];for(var h in e)if(e[h].then&&1!==e[h].settled){g.push(e[h]);var i=function(a,b,c,d){return function(){for(var e in a)if(1!==a[e].settled)return;k.run_train(b,c,d,{pause_on_deferred:!0})}}(g,a,b,c);return void e[h].callbacks.resolve.hooks.onComplete.train.push(i)}}}}b.hooks&&b.hooks.onComplete.train.length>0&&k.run_train(a,b.hooks.onComplete,e,{pause_on_deferred:!1})},k.set_state=function(a,b){a.state=b,(1===b||2===b)&&(a.settled=1),(1===b||2===b)&&k.signal_downstream(a)},k.get_state=function(a){return a.state},k.activate=function(a){return d.list[a.id]&&!d.list[a.id].overwritable?(d.debug("Tried to overwrite "+a.id+" without overwrite permissions."),d.list[a.id]):(d.list[a.id]=a,k.auto_timeout.call(a),e.hooks.onActivate&&e.hooks.onActivate(a),a)},k.auto_timeout=function(a){if(this.timeout="undefined"==typeof a?this.timeout:a,!this.type||"timer"!==this.type){if(this.timeout_id&&clearTimeout(this.timeout_id),"undefined"==typeof this.timeout)d.debug(["Auto timeout this.timeout cannot be undefined.",this.id]);else if(-1===this.timeout)return!1;var b=this;this.timeout_id=setTimeout(function(){k.auto_timeout_cb.call(b)},this.timeout)}return!0},k.auto_timeout_cb=function(){if(1!==this.state){var a=[],b=this,c=function(a){return 1!==a.state?a.id:!1};if(e.debug_mode){var d=k.search_obj_recursively(this,"upstream",c);return a.push(b.id+": rejected by auto timeout after "+this.timeout+"ms"),a.push("Cause:"),a.push(d),this.reject.call(this,a)}return this.reject.call(this)}},k.error=function(a){return 2===this.state?a():this.reject_q.push(a),this},k.signal_downstream=function(a){for(var b in a.downstream)if(1===a.downstream[b].settled){if(1!==a.downstream[b].state)continue;d.debug(a.id+" tried to settle promise '"+a.downstream[b].id+"' that has already been settled.")}for(var b in a.downstream)1!==a.downstream[b].settled&&k.queue.receive_signal(a.downstream[b],a.id)},k.search_obj_recursively=function(a,b,c,e){"undefined"==typeof e&&(e=[a.id]);var f;for(var g in a[b])if(f=c(a[b][g]),f!==!1){if(-1!==e.indexOf(f))return d.debug(["Circular condition in recursive search of obj property '"+b+"' of object "+("undefined"!=typeof a.id?"'"+a.id+"'":"")+". Offending value: "+f,function(){return e.push(f),e.join(" [depends on]=> ")}()]);if(e.push(f),a[b][g][b])return k.search_obj_recursively(a[b][g],b,c,e);break}return e},k.convert_to_promise=function(a,b){if(a.id=a.id||b.id,a.id||("timer"===a.type?a.id="timer-"+a.timeout+"-"+ ++d[i]:"string"==typeof a.url&&(a.id=a.url.split("/").pop(),-1!==a.id.search(".js")&&(a.id=a.id.split("."),a.id.pop(),a.id=a.id.join(".")))),d.list[a.id]&&"timer"!==a.type){if(!a.resolver)return d.list[a.id];d.debug(["You can't set a resolver on a queue that has already been declared. You can only reference the original.","Detected re-init of '"+a.id+"'.","Attempted:",a,"Existing:",d.list[a.id]])}var c;switch(!0){case"event"===a.type:c=k.wrap_event(a);break;case"queue"===a.type:c=f(a.dependencies,a);break;case"function"==typeof a.then:switch(!0){case"string"==typeof a.id:console.warn("'"+a.id+"': did not exist. Auto creating new deferred."),c=j.deferred({id:a.id}),a.then&&a.then(function(a){c.resolve(a)});break;case"function"==typeof a.promise:c=a.scope?a.promise.call(a.scope):a.promise();break;case a.then:c=a}if("object"!=typeof c||!c.then)return d.debug("Dependency labeled as a promise did not return a promise.",a);break;case"timer"===a.type:c=k.wrap_timer(a);break;default:a.type=a.type||"default",b.parent&&b.parent.cwd&&(a.cwd=b.parent.cwd),c=k.wrap_xhr(a)}return d.list[a.id]=c,c},k.wrap_event=function(a){var b=j.deferred({id:a.id});if("undefined"!=typeof document&&"undefined"!=typeof window)if("function"!=typeof $){var c="window and document based events depend on jQuery";b.reject(c)}else switch(!0){case"ready"===a.id||"DOMContentLoaded"===a.id:$(document).ready(function(){b.resolve(1)});break;case"load"===a.id:$(window).load(function(){b.resolve(1)});break;default:$(document).on(a.id,"body",function(){b.resolve(1)})}return b},k.wrap_timer=function(a){var b=j.deferred(a);return function(b){var c=(new Date).getTime();setTimeout(function(){var d=(new Date).getTime();b.resolve({start:c,end:d,elapsed:d-c,timeout:a.timeout})},a.timeout)}(b),b},k.wrap_xhr=function(a){var b=["id","url"];for(var c in b)if(!a[b[c]])return d.debug(["File requests converted to promises require: "+b[c],"Make sure you weren't expecting dependency to already have been resolved upstream.",a]);if(d.list[a.id])return d.list[a.id];var f=j.deferred(a);return"undefined"!=typeof h[e.mode][a.type]?h[e.mode][a.type](a.url,f,a):h[e.mode]["default"](a.url,f,a),f},b.exports=j},{"./deferred.tpl.js":4,"./file_loader.js":5,"./main.js":6,"./queue.js":7,lodash:void 0}],4:[function(a,b){"use strict";var c=a("./main.js"),d=c.config(),e={};e.is_orgy=!0,e.id=null,e.settled=0,e.state=0,e.value=[],e.caboose=null,e.model="deferred",e.done_fired=0,e.timeout_id=null,e.callback_states={resolve:0,then:0,done:0,reject:0},e.callbacks=function(){var a={};for(var b in e.callback_states)a[b]={train:[],hooks:{onBefore:{train:[]},onComplete:{train:[]}}};return a}(),e.downstream={},e.execution_history=[],e.overwritable=0,e.timeout=d.timeout,e.remote=1,e.list=1,e.resolve=function(a){if(1===this.settled&&c.debug([this.id+" can't resolve.","Only unsettled deferreds are resolvable."]),this.set_state(this,-1),this.value=a,this.resolver_fired||"function"!=typeof this.resolver)this.resolver_fired=1,this.callbacks.resolve.hooks.onComplete.train.unshift(function(){settle(this)});else{this.resolver_fired=1;try{this.callbacks.resolve.train.push(function(){this.resolver(a,this)})}catch(b){}}return this.run_train(this,this.callbacks.resolve,this.value,{pause_on_deferred:!1}),this},e.reject=function(a){a instanceof Array||(a=[a]);var b="Rejected "+this.model+": '"+this.id+"'.";return d.debug_mode?(a.unshift(b),c.debug(a,this)):(b+="\n Turn debug mode on for more info.",console.log(b)),this.timeout_id&&clearTimeout(this.timeout_id),this.set_state(this,2),this.run_train(this,this.callbacks.reject,a,{pause_on_deferred:!1}),this},e.then=function(a,b){switch(!0){case 2===this.state:break;case 1===this.done_fired:return c.debug(this.id+" can't attach .then() because .done() has already fired, and that means the execution chain is complete.");default:this.callbacks.then.train.push(a),"function"==typeof b&&this.callbacks.reject.train.push(b),1!==this.settled||1!==this.state||this.done_fired||this.run_train(this,this.callbacks.then,this.caboose,{pause_on_deferred:!0})}return this},e.done=function(a,b){if(0!==this.callbacks.done.train.length||0!==this.done_fired)return c.debug("done() can only be called once.");if("function"!=typeof a)return c.debug("done() must be passed a function.");var d=function(b,c,d){c.done_fired=1,a(b,c,d)};this.callbacks.done.train.push(d),"function"==typeof b&&this.callbacks.reject.hooks.onComplete.train.push(b),1===this.settled&&(1===this.state?this.run_train(this,this.callbacks.done,this.caboose,{pause_on_deferred:!1}):this.run_train(this,this.callbacks.reject,this.caboose,{pause_on_deferred:!1}))},b.exports=e},{"./main.js":6}],5:[function(a,b){"use strict";var c=a("./main.js"),d=a("http"),e=a("vm"),f={};f.browser={},f["native"]={},f.browser.css=function(a,b){var c=document.getElementsByTagName("head")[0]||document.documentElement,d=document.createElement("link");d.setAttribute("href",a),d.setAttribute("type","text/css"),d.setAttribute("rel","stylesheet"),d.onload?(!function(a){a.onload=a.onreadystatechange=function(b,c){c.resolve(a)},a.onerror=function(a,b){b.reject("Failed to load path: "+a)}}(d,a,b),c.appendChild(d)):c.appendChild(d)},f.browser.script=function(a,b){var c=document.createElement("script");c.type="text/javascript",c.setAttribute("src",a),function(a,b,c){a.onload=a.onreadystatechange=function(){("boolean"!=typeof c.autoresolve||c.autoresolve===!0)&&c.resolve("undefined"!=typeof a.value?a.value:a)},a.onerror=function(){c.reject("Error loading: "+b)}}(c,a,b),this.head.appendChild(c)},f.browser.html=function(a,b){this["default"](a,b)},f.browser["default"]=function(a,b,c){var d,e=new XMLHttpRequest;e.open("GET",a,!0),function(a,b){e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status){if(d=e.responseText,c.type&&"json"===c.type)try{d=JSON.parse(d)}catch(g){f.debug(["Could not decode JSON",a,d],b)}b.resolve(d)}else b.reject("Error loading: "+a)}}(a,b),e.send(null)},f["native"].css=function(a,b){f.browser.css(a,b)},f["native"].script=function(b,d){if("."===b[0]){var f=a(b);d.resolve(f)}else c.config.debug_mode?_private["native"].get(b,d,function(a){f=e.runInThisContext(a),d.resolve(f)}):(_,c.debug("Set Main.config.debug_mode=1 to run remote scripts outside of debug mode."))},f["native"].html=function(a,b){f["native"]["default"](a,b)},f["native"]["default"]=function(a,b){_private["native"].get(a,b,function(a){b.resolve(a)})},_private["native"].get=function(a,b,c){"."===a[0]?Fs.readFile(a,function(a,b){if(a)throw a;c(b)}):d.get({path:a},function(a){var b="";a.on("data",function(a){b+=a}),a.on("end",function(){c(b)})})},b.exports=f},{"./main.js":6,http:void 0,vm:void 0}],6:[function(a,b){(function(c,d){"use strict";var e=a("./queue.js"),f=a("./deferred.js"),g=a("./cast.js"),h={},i={};h.list={},h.modules_exported=[],h.modules_loaded=0,h.i=0,i.config={autopath:"",document:null,debug_mode:1,cwd:!1,mode:function(){return"object"==typeof c&&c+""=="[object process]"?"native":"browser"}(),hooks:{},timeout:5e3},h.config=function(a){if("object"==typeof a)for(var b in a)i.config[b]=a[b];return i.config},h.define=function(a,b,c){var d;if(c=c||{},c.dependencies=c.dependencies||null,c.resolver=c.resolver||null,"string"!=typeof a&&h.debug("Must set id when defining an instance."),h.list[a]&&1===h.list[a].settled)return h.debug("Can't define "+a+". Already resolved.");if(c.id=a,c.backtrace=this.get_backtrace_info("define"),null!==c.dependencies&&c.dependencies instanceof Array){var g=c.dependencies;delete c.dependencies,d=e(g,c)}else d=f(c),null!==c.resolver||"boolean"==typeof c.autoresolve&&c.autoresolve!==!0||(d.autoresolve=!1,d.resolve(b));return d},h.define_module=function(a){var b={},c=a.q.__id;if("undefined"==typeof Orgy.list[c]||0===Orgy.list[c].state){if(a.q.__dependencies&&(b.dependencies=a.q.__dependencies),a.q.__resolver&&(b.resolver=a.q.__resolver.bind(a)),"native"===i.config.mode){b.cwd=d;var e=this.define(c,a._public,b);return e}this.define(c,a._public,b)}},h.get=function(a){return h.list[a]?h.list[a]:h.debug(["No instance exists: "+a])},h.assign=function(a,b,c){c="boolean"==typeof c?c:1;var d,f;switch(!0){case"object"==typeof a&&"function"==typeof a.then:d=a.id;break;case"string"==typeof a:d=a;break;default:return h.debug("Assign target must be a queue object or the id of a queue.",this)}if(this.list[d]&&"queue"===this.list[d].model)f=this.list[d],c?f.add(b):f.remove(b);else{if(!c)return h.debug("Cannot remove dependencies from a queue that does not exist.",this);f=e(b,{id:d})}return f},h.debug=function(a,b){a instanceof Array||(a=[a]);for(var d in a)console.error("string"==typeof a[d]?"ERROR-"+d+": "+a[d]:a[d]);return b&&(console.log("Backtrace:"),console.log(b.backtrace.stack)),i.config.debug_mode,"browser"===i.config.mode?!1:void c.exit()},h.get_backtrace_info=function(a){var b,c,d={};if(b=d.stack=(new Error).stack,"browser"===i.config.mode){for(b=b.split(a)[1].trim().split("\n"),c=b.pop();-1!==c.search("orgy")&&b.length>0;)c=b.pop();c=window.location.protocol+"//"+c.split("//")[1]}else c=b.split(a+" ")[1].split("\n")[1],c=c.match(/\(([^)]+)\)/)[1];return d.origin=c,d},h.deferred=f.deferred,h.queue=e.queue,h.cast=g.cast,b.exports=h}).call(this,a("_process"),"/src/js")},{"./cast.js":2,"./deferred.js":3,"./queue.js":7,_process:1}],7:[function(a,b){"use strict";var c=a("lodash"),d=a("./main.js"),e=a("./deferred.js"),f={},g={};g.tpl={model:"queue",resolver_fired:0,halt_resolution:0,upstream:{},dependencies:[],add:function(a){try{if(0===a.length)return this.upstream}catch(b){d.debug(b)}if(0!==this.state)return d.debug(["Cannot add dependency list to queue id:'"+this.id+"'. Queue settled/in the process of being settled."],a,this);for(var c in a){switch(!0){case"object"==typeof d.list[a[c].id]:a[c]=d.list[a[c].id];break;case"object"==typeof a[c]&&!a[c].is_orgy:a[c]=e.convert_to_promise(a[c],{parent:this});break;case"function"==typeof a[c].then:break;default:console.error("Object could not be converted to promise."),console.error(a[c]);continue}for(var f in this.downstream)if(f===a[c].id)return d.debug(["Error adding upstream dependency '"+a[c].id+"' to queue '"+this.id+"'.\n Promise object for '"+a[c].id+"' is scheduled to resolve downstream from queue '"+this.id+"' so it can't be added upstream."],this);this.upstream[a[c].id]=a[c],a[c].downstream[this.id]=this,this.dependencies.push(a[c])}return this.upstream},remove:function(a){if(0!==this.state)return d.debug("Cannot remove list from queue id:'"+this.id+"'. Queue settled/in the process of being settled.");for(var b in a)this.upstream[a[b].id]&&(delete this.upstream[a[b].id],delete a[b].downstream[this.id])},reset:function(a){return 1!==this.settled||1!==this.state?d.debug("Can only reset a queue settled without errors."):(a=a||{},this.settled=0,this.state=0,this.resolver_fired=0,this.done_fired=0,this.timeout_id&&clearTimeout(this.timeout_id),this.downstream={},this.dependencies=[],e.auto_timeout.call(this,a.timeout),this)},check_self:function(){return f.receive_signal(this,this.id),this.state}},f.queue=function(a,b){var c;if(!(a instanceof Array))return d.debug("Queue dependencies must be an array.");if(b=b||{},d.list[b.id]){if(c=d.list[b.id],"queue"!==c.model)b.overwritable=1,c=g.upgrade(c,b,a);else{for(var e in b)c[e]=b[e];a.length>0&&g.tpl.add.call(c,a)}c.halt_resolution="undefined"!=typeof b.halt_resolution?b.halt_resolution:0}else{var c=g.factory(b);c=g.activate(c,b,a)}return c},f.receive_signal=function(a,b){if(1!==a.halt_resolution){if(b!==a.id&&!a.upstream[b])return d.debug(b+" can't signal "+a.id+" because not in upstream.");var c=1;for(var f in a.upstream)if(1!==a.upstream[f].state){c=a.upstream[f].state;break}if(1===c){var g=[];for(var f in a.dependencies)g.push(a.dependencies[f].value);e.tpl.resolve.call(a,g)}if(2===c){var h=[a.id+" dependency '"+a.upstream[f].id+"' was rejected.",a.upstream[f].arguments];e.tpl.reject.apply(a,h)}}},g.factory=function(a){var b=c.assign({},[e.tpl,g.tpl,a]);return b.backtrace||(b.backtrace=d.get_backtrace_info("queue")),a.id||(b.id=b.backtrace.origin+"-"+ ++d[i]),b},g.activate=function(a,b,c){return a=e.activate(a),a.state=-1,setTimeout(function(){if(a.state=0,g.tpl.add.call(a,c),f.receive_signal(a,a.id),a.assign)for(var b in a.assign)f.assign(a.assign[b],[a],!0)},1),a},g.upgrade=function(a,b,e){if(0!==a.settled||"promise"!==a.model&&"deferred"!==a.model)return d.debug("Can only upgrade unsettled promise or deferred into a queue.");var f=c.assign({},[g.tpl,b]);for(var h in f)a[h]=f[h];return a=g.activate(a,b,e)},b.exports=f},{"./deferred.js":3,"./main.js":6,lodash:void 0}]},{},[2,3,4,5,6,7])}({},function(){return this}());