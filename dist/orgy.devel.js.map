{"version":3,"file":"orgy.devel.js","sources":["?","../src/js/main.js","../src/js/deferred.js","../src/js/deferred.tpl.js","../src/js/queue.js","../src/js/cast.js","../src/js/build.js"],"names":["exports","global","public","private","list","modules_exported","modules_loaded","registered_callbacks","i","config","autopath","document","debug_mode","mode","process","obj","debug","define","id","data","def","settled","__dependencies","call","__id","queue","__ui","_is_orgy_module","resolver","__resolver","bind","deferred","resolve","get","options","assign","tgt","arr","add","q","then","this","model","remove","register_callback","req","array_to_function","target","clone","slice","pathstr","join","root_id","splice","root","hasOwnProperty","value","window","x","y","l","length","args","end","Array","parent","b","key","constructor","naive_cloner","donors","o","a","JSON","parse","stringify","msg","console","error","origin_stack","log","exit","ss","Error","stack","split","trim","location","protocol","_o","factory","activate","tpl","settle","timeout_id","clearTimeout","set_state","callbacks","hooks","onComplete","train","push","d2","itinerary","last","caboose","run_train","done","pause_on_deferred","param","r","onBefore","shift","execution_history","thenables","fn","t","int","state","signal_downstream","get_state","overwritable","auto_timeout","timeout","type","scope","setTimeout","auto_timeout_cb","msgs","search_obj_recursively","reject","cb","reject_q","downstream","receive_signal","propName","breadcrumb","r1","indexOf","convert_to_promise","url","pop","search","prom","_wrap_event","warn","promise","_wrap_timer","_wrap_xhr","$","ready","load","on","_start","Date","getTime","_end","start","elapsed","dep","required","attach_xhr","Orgy","replace","head","getElementsByTagName","documentElement","node","createElement","setAttribute","onload","onreadystatechange","onerror","appendChild","reeject","XMLHttpRequest","open","show_messages","setRequestHeader","return_packet","readyState","status","responseText","e","send","process_result","remote","request","require","response","body","statusCode","append","fs","readFile","err","cwd","done_fired","callback_states","resolver_fired","unshift","rejector","fn2","halt_resolution","upstream","dependencies","reset","check_self","deps","upgrade","from_id","values","arguments","apply","cast","module"],"mappings":"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","sourcesContent":[null,"var public = {};\nvar private = {};\n\n\n////////////////////////////////////////\n//  PUBLIC VARIABLES\n////////////////////////////////////////\n\n\n/**\n * A directory of all promises, deferreds, and queues.\n * @type object\n */\npublic.list = {};\n\n\n/**\n * Array of all exported modules\n * @type Array\n */\npublic.modules_exported = [];\n\n\n/**\n * Index number of last module loaded in public.modules_exported\n * @type Number\n */\npublic.modules_loaded = 0;\n\n\n/** \n * Callbacks that are run on every resolved item\n * \n */\npublic.registered_callbacks = {};\n\n\n/**\n * iterator for ids\n * @type integer\n */\npublic.i = 0;\n\n\n////////////////////////////////////////\n//  PRIVATE VARIABLES\n////////////////////////////////////////\n\n\n/**\n * Configuration values.\n * \n * @type object\n */\nprivate.config = {\n    \n    autopath : ''\n    ,document : null\n    ,debug_mode : 0\n    ,mode : (function(){\n        if(typeof process === 'object' && process + '' === '[object process]'){\n            // is node\n            return \"node\";\n        }\n        else{\n            // not node\n            return \"browser\";\n        }\n    }())\n};\n\n\n////////////////////////////////////////\n//  PUBLIC METHODS\n////////////////////////////////////////\n\n\n/**\n * Configuration setter.\n * \n * @param {object} obj\n * @returns {object}\n */\npublic.config = function(obj){\n    \n    if(obj){\n        for(var i in obj){\n            if(typeof private.config[i] !== 'undefined'){\n                private.config[i] = obj[i];\n            }\n            else{\n                return public.debug(\"Property '\"+i+\"' is not configurable.\");\n            }\n        }\n    }\n    \n    return private.config;\n};\n\n\n/**\n* Creates a new promise from a value and an id and automatically \n* resolves it.\n* \n* @param {string} id\n* @param {mixed} data\n* @returns {object} resolved promise\n*/\npublic.define = function(id,data){\n    \n    var def;\n\n    //MAKE SURE NOT TRYING TO RESOLVE EXISTING DEF\n    if(public.list[id] && public.list[id].settled === 1){\n        return public.debug(\"Can't define \" + id + \". Already resolved.\");\n    }\n\n    data.__dependencies = (typeof data.__dependencies === 'function') \n        ? data.__dependencies.call(data) \n        : data.__dependencies;\n    \n    //ORGY MODULE HANDLING\n    if(typeof data === 'object' && typeof data.__id === 'string'){\n        \n        def = public.queue(data.__dependencies || [],{\n            id : id\n            ,__ui : (typeof data.__ui !== 'undefined') ? data.__ui : 1\n            ,_is_orgy_module : 1\n            ,resolver : (typeof data.__resolver === 'function')\n            ? data.__resolver.bind(data) : null\n        });\n    }\n    else{\n\n        //CREATE/GET DEFERRED\n        def = public.deferred({\n           id : id\n        });\n\n        //SETTLE \n        def.resolve(data);\n       \n    }\n    \n    return def;\n};\n\n\n/**\n * Getter.\n * \n * @param {string} id\n * @param {object} options\n * @returns {object}\n */\npublic.get = function(id,options){\n  if(public.list[id]){\n    return public.list[id];\n  }\n  else{\n    return public.debug([\n      \"No instance exists: \"+id\n    ]);\n  }\n};\n\n\n/**\n * Add/remove an upstream dependency to/from a queue. \n * \n * Can use a queue id, even for a queue that is yet to be created.\n * \n * @param {string} tgt | queue / queue id\n * @param {array}  arr | list/promise ids,dependencies\n * @param {boolean} add | add if true, remove if false\n * \n * @return {array} queue of list\n */\npublic.assign = function(tgt,arr,add){\n\n    add = (typeof add === \"boolean\") ? add : 1;\n\n    var id,q;\n    switch(true){\n        case(typeof tgt === 'object' && typeof tgt.then === 'function'):\n            id = tgt.id;\n            break;\n        case(typeof tgt === 'string'):\n            id = tgt;\n            break;\n        default:\n            return public.debug(\"Assign target must be a queue object or the id of a queue.\",this);\n    }\n\n    //IF TARGET ALREADY LISTED\n    if(this.list[id] && this.list[id].model === 'queue'){\n        q = this.list[id];\n        \n        //=> ADD TO QUEUE'S UPSTREAM\n        if(add){\n            q.add(arr);\n        }\n        //=> REMOVE FROM QUEUE'S UPSTREAM\n        else{\n            q.remove(arr);\n        }\n    }\n    //CREATE NEW QUEUE AND ADD DEPENDENCIES\n    else if(add){\n\n        q = public.queue(arr,{\n            id : id\n        });\n    }\n    //ERROR: CAN'T REMOVE FROM A QUEUE THAT DOES NOT EXIST\n    else{\n        return public.debug(\"Cannot remove dependencies from a queue that does not exist.\",this);\n    }\n\n    return q;\n};\n\n\npublic.register_callback = function(obj){\n    \n    var req = ['id','fn'];\n    for(var i in req){\n        if(typeof obj[req[i]] === 'undefined'){\n            return public.debug(\"registered callbacks require property: \"+req[i]);\n        }\n    }\n    \n    public.registered_callbacks[obj.id] = obj;\n};\n\n    \n/**\n * Converts a specially formatted array into a function.\n * \n * \n * @param {type} target\n * @returns {object}\n */\npublic.array_to_function = function(target){\n\n    //CLONE TARGET\n    var clone = target.slice(0);\n    \n    //Make a string copy for debugging.\n    var pathstr = clone.join(\".\");\n\n    var root_id = clone[0];\n    clone.splice(0,1);\n\n    var root;\n    if(public.list[root_id] && public.list[root_id].hasOwnProperty(\"value\")){\n        root = public.list[root_id].value; \n    }\n    else{\n        root = window[root_id];\n    }\n\n\n    if(typeof root === 'undefined'){\n        return public.debug(root_id + \" not found on window or public.list\");\n    }\n\n\n    var x,y;\n    x = y = root;\n\n    //REMOVE LAST ARRAY ELEMENT (ARGS)\n    var l = clone.length;\n    var args = clone[l-1];\n\n    //POINTER TO A FUNCTION WILL HAVE AN ARRAY AS LAST ELEMENT\n    var end;\n    if(args instanceof Array){\n        end = l - 1;\n    }\n    //POINTER TO AN ARRAY WILL NOT\n    else{\n        end = l;\n    }\n\n    var parent;\n    for(var b=0; b < end; b++){\n        var key = clone[b];\n\n        if(b === end - 1 || l === 1){\n           parent = x; \n        }\n\n        if(typeof x[key] === 'undefined'){\n            return public.debug([\n                \"Property '\"+key+\"' undefined @\"\n                ,pathstr\n                ,clone\n            ]);\n        }\n        x = x[key];\n        y = x;\n    }    \n\n    return {\n        constructor : x\n        ,args : args\n        ,parent : parent\n    };\n};\n\n\n/**\n * Makes a shallow copy of an array. \n * Makes a copy of an object so long as it is JSON\n * \n * @param {array} donors /array of donor objects, \n *                overwritten from right to left\n * @returns {object}\n */\npublic.naive_cloner = function(donors){\n    var o = {};\n    for(var a in donors){\n        for(var b in donors[a]){\n            if(donors[a][b] instanceof Array){\n                o[b] = donors[a][b].slice(0);\n            }\n            else if(typeof donors[a][b] === 'object'){\n                o[b] = JSON.parse(JSON.stringify(donors[a][b]));\n            }\n            else{\n                o[b] = donors[a][b];\n            }\n        }\n    }\n    return o;\n};\n        \n\n/**\n * Debugging method.\n * \n * @param {string|array} msg\n * @param {object} def\n * @returns {Boolean}\n */\npublic.debug = function(msg,def){\n    \n    if(! (msg instanceof Array)){\n        msg = [msg];\n    }\n\n    for(var i in msg){\n        if(typeof msg[i] === 'string'){\n            console.error(\"ERROR-\"+i+\": \"+msg[i]);\n        }\n        else{\n            console.error(msg[i]);\n        }\n    }\n\n    //if we saved a stack trace to connect async, push it\n    if(def && def.origin_stack){\n        console.log(\"Backtrace:\");\n        for(var i in def.origin_stack){\n          console.log(def.origin_stack[i]);\n        }\n    }\n    \n    debugger;\n    \n    if(private.config.mode === 'browser'){\n        return false;\n    }\n    else{\n        process.exit();\n    }\n};\n\n\n////////////////////////////////////////\n//  PUBLIC METHODS\n////////////////////////////////////////\n\n\nprivate.origin_stack = function(ss){\n\n    var l = new Error().stack.split(ss)[1].trim();\n\n    if(private.config.mode === 'browser'){\n        l = l.split(\"//\");\n        l = l.slice(1);\n        for(var i in l){\n          l[i] = window.location.protocol + \"//\" + l[i].split(\" \")[0];\n        }//[2].split(\" \")[0].trim();\n    }\n    else{\n        l = '/' + l.split(\"(/\")[2].split(\" \")[0].trim().slice(0,-1);\n    }\n    \n    return l;\n};","/**\n * Deferred class.\n * \n */\n\npublic.deferred = {};\nprivate.deferred = {};\n\n\n//////////////////////////////////////////\n//  PUBLIC VARIABLES\n//////////////////////////////////////////\n\n\n//////////////////////////////////////////\n//  PRIVATE VARIABLES\n//////////////////////////////////////////\n\n\n//////////////////////////////////////////\n//  PUBLIC METHODS\n//////////////////////////////////////////\n\n\npublic.deferred = function(options){\n    \n    options = options || {};\n    \n    if(options.id && public.list[options.id]){\n        _o = public.list[options.id];\n    }\n    else{\n        //CREATE NEW INSTANCE OF DEFERRED CLASS\n        var _o = private.deferred.factory(options);\n\n        //ACTIVATE DEFERRED\n        _o = private.deferred.activate(_o);\n    }\n    \n    return _o;\n};\n\n\n////////////////////////////////////////\n//  PRIVATE METHODS\n////////////////////////////////////////\n\n\nprivate.deferred.factory = function(options){\n        \n    var _o = public.naive_cloner([\n        private.deferred.tpl\n        ,options\n    ]);\n    \n    //Save backtrace for async debugging\n    _o.origin_stack = private.origin_stack('public.deferred');\n\n    //if no id, use code line origin + iterator\n    if(typeof options.id !== 'string'){\n        _o.id = _o.origin_stack[_o.origin_stack.length -1] \n                + '('+(public.i++)+')';\n    }\n    \n    return _o;\n};\n    \n\nprivate.deferred.settle = function(def){\n    \n    //REMOVE AUTO TIMEOUT TIMER\n    if(def.timeout_id){\n        clearTimeout(def.timeout_id);\n    }\n    \n    \n    //Set state to resolved\n    private.deferred.set_state(def,1);\n    \n    \n    //Add done as a callback to then chain completion.\n    def.callbacks.then.hooks.onComplete.train.push(function(d2,itinerary,last){\n        def.caboose = last;\n        \n        //Run done\n        private.deferred.run_train(\n            def\n            ,def.callbacks.done\n            ,def.caboose\n            ,{pause_on_deferred : false}\n        );\n\n    });\n    \n  \n    //Run then queue\n    private.deferred.run_train(\n        def\n        ,def.callbacks.then\n        ,def.value\n        ,{pause_on_deferred : true}\n    );\n    \n    \n    return def;\n};\n\n\n/**\n * Runs an array of functions sequentially as a partial function.\n * Each function's argument is the result of its predecessor function.\n * \n * By default, execution chain is paused when any function \n * returns an unresolved deferred. (pause_on_deferred) [OPTIONAL]\n * \n * @param {object} def  /deferred object\n * @param {object} obj  /itinerary\n *      train       {array}\n *      hooks       {object}    \n *          onBefore        {array}\n *          onComplete      {array}\n * @param {mixed} param /param to pass to first callback\n * @param {object} options\n *      pause_on_deferred   {boolean}\n *      \n * @returns {void}\n */\nprivate.deferred.run_train = function(def,obj,param,options){\n    \n    //allow previous return values to be passed down chain\n    var r = param || def.caboose || def.value;\n    \n    //onBefore event\n    if(obj.hooks && obj.hooks.onBefore.train.length > 0){\n        private.deferred.run_train(\n            def\n            ,obj.hooks.onBefore\n            ,param\n            ,{pause_on_deferred : false}\n        );\n    }\n    \n    while(obj.train.length > 0){\n        \n        //remove fn to execute\n        var last = obj.train.shift();\n        def.execution_history.push(last);\n  \n        r = last.call(def,def.value,def,r);\n\n        //if result is an thenable, halt execution \n        //and run unfired arr when thenable settles\n        if(options.pause_on_deferred){\n            \n            //If r is an unsettled thenable\n            if(r && r.then && r.settled !== 1){\n\n                //execute rest of this train after r resolves\n                r.callbacks.resolve.hooks.onComplete.train.push(function(){\n\n                    private.deferred.run_train(\n                        def\n                        ,obj\n                        ,param\n                        ,{pause_on_deferred : true}\n                    );\n                });\n\n                //terminate execution\n                return;\n            }\n            \n            //If is an array than contains an unsettled thenable\n            else if(r instanceof Array){\n\n                var thenables = [];\n\n                for(var i in r){\n                    \n                    if(r[i].then && r[i].settled !== 1){\n                        \n                        thenables.push(r[i]);\n           \n                        var fn = (function(t,def,obj,param){\n                    \n                            return function(){\n      \n                                //Bail if any thenables unsettled\n                                for(var i in t){\n                                    if(t[i].settled !== 1){\n                                        return;\n                                    }\n                                }\n\n                                private.deferred.run_train(\n                                    def\n                                    ,obj\n                                    ,param\n                                    ,{pause_on_deferred : true}\n                                );\n                            };\n                            \n                        })(thenables,def,obj,param);\n                        \n                        //execute rest of this train after\n                        //all thenables found in r resolve\n                        r[i].callbacks.resolve.hooks.onComplete.train.push(fn);\n\n                        //terminate execution\n                        return;\n                    }\n                }\n            }\n        }\n    }\n    \n    //onComplete event\n    if(obj.hooks && obj.hooks.onComplete.train.length > 0){\n        private.deferred.run_train(def\n                                ,obj.hooks.onComplete\n                                ,r\n                                ,{pause_on_deferred : false});\n    }\n};\n\n\n/**\n * Sets the state of an Orgy object.\n * \n * @param {object} def\n * @param {number} int\n * @returns {void}\n */\nprivate.deferred.set_state = function(def,int){\n\n    def.state = int;\n\n    //IF RESOLVED OR REJECTED, SETTLE\n    if(int === 1 || int === 2){\n        def.settled = 1;\n    }\n\n    if(int === 1 || int === 2){\n        private.deferred.signal_downstream(def);\n    }\n};\n    \n   \n/**\n * Gets the state of an Orgy object\n * \n * @param {object} def\n * @returns {number} \n */\nprivate.deferred.get_state = function(def){\n    return def.state;\n};\n\n\nprivate.deferred.activate = function(obj){\n    \n    //MAKE SURE NAMING CONFLICT DOES NOT EXIST\n    if(public.list[obj.id] && !public.list[obj.id].overwritable){\n        public.debug(\"Tried to overwrite \"+obj.id+\" without overwrite permissions.\");\n        return public.list[obj.id];\n    }\n    else{\n        //SAVE TO MASTER LIST\n        public.list[obj.id] = obj;\n    }\n\n    //AUTO TIMEOUT\n    private.deferred.auto_timeout.call(obj);\n\n    return obj;\n};\n\n\n/**\n * Sets the automatic timeout on a promise object.\n * \n * @param {integer} timeout (optional)\n * @returns {Boolean}\n */\nprivate.deferred.auto_timeout = function(timeout){\n\n    this.timeout = (typeof timeout === 'undefined') \n    ? this.timeout : timeout;\n\n    //AUTO REJECT ON timeout\n    if(!this.type || this.type !== 'timer'){\n\n        //DELETE PREVIOUS TIMEOUT IF EXISTS\n        if(this.timeout_id){\n            clearTimeout(this.timeout_id);\n        }\n\n        if(typeof this.timeout === 'undefined'){\n            public.debug(this.id+\" Auto timeout this.timeout cannot be undefined.\");\n        }\n        else if (this.timeout === -1){\n            //NO AUTO TIMEOUT SET\n            return false;\n        }\n        var scope = this;\n\n        this.timeout_id = setTimeout(function(){\n            private.deferred.auto_timeout_cb.call(scope);\n        }, this.timeout);\n    }\n    else{\n        //@todo WHEN A TIMER, ADD DURATION TO ALL UPSTREAM AND LATERAL?\n    }\n    \n    return true;\n};\n\n\n/**\n * Callback for autotimeout. Declaration here avoids memory leak.\n * \n * @returns {undefined}\n */\nprivate.deferred.auto_timeout_cb = function(){\n\n    if(this.state !== 1){\n\n        //GET THE UPSTREAM ERROR ID\n        var msgs = [];\n        var scope = this;\n\n        var fn = function(obj){\n            if(obj.state !== 1){\n                return obj.id;\n            }\n            else{\n                return false;\n            }\n        };\n\n        /**\n         * Run over a given object property recursively, \n         * applying callback until \n         * callback returns a non-false value.\n         */\n        if(private.config.debug_mode){\n            var r = private.deferred.search_obj_recursively(this,'upstream',fn);\n            msgs.push(scope.id + \": rejected by auto timeout after \" \n                    + this.timeout + \"ms\");\n            msgs.push(\"Cause:\");\n            msgs.push(r);\n            return private.deferred.tpl.reject.call(this,msgs);\n        }\n        else{\n            return private.deferred.tpl.reject.call(this);\n        }\n        \n\n    }\n};\n\n\nprivate.deferred.error = function(cb){\n\n    //IF ERROR ALREADY THROWN, EXECUTE CB IMMEDIATELY\n    if(this.state === 2){\n        cb();\n    }\n    else{\n        this.reject_q.push(cb);\n    }\n\n    return this;\n};\n\n\n/**\n * Signals all downstream promises that private promise object's state has changed.\n * \n * \n * @todo Since the same queue may have been assigned twice directly or \n * indirectly via shared dependencies, make sure not to double resolve\n * - which throws an error.\n *     \n * @param {object} target deferred/queue\n * @returns {void}\n */\nprivate.deferred.signal_downstream = function(target){\n\n    //MAKE SURE ALL DOWNSTREAM IS UNSETTLED\n    for(var i in target.downstream){\n        if(target.downstream[i].settled === 1){\n            public.debug(target.id + \" tried to settle promise \"+\"'\"+target.downstream[i].id+\"' that has already been settled.\");\n        }\n    }\n\n    //NOW THAT WE KNOW ALL DOWNSTREAM IS UNSETTLED, WE CAN IGNORE ANY\n    //SETTLED THAT RESULT AS A SIDE EFFECT TO ANOTHER SETTLEMENT\n    for (var i in target.downstream){\n        if(target.downstream[i].settled !== 1){\n            private.queue.receive_signal(target.downstream[i],target.id);\n        }\n    }\n};\n    \n    \n/**\n* Run over a given object property recursively, applying callback until \n* callback returns a non-false value.\n* \n* @param {object} obj      \n* @param {string} propName          The property name of the array to bubble up\n* @param {function} fn              The test callback to be applied to each object\n* @param {array} breadcrumb         The breadcrumb through the chain of the first match\n* @returns {mixed}\n*/\nprivate.deferred.search_obj_recursively = function(obj,propName,fn,breadcrumb){\n\n    if(typeof breadcrumb === 'undefined'){\n        breadcrumb = [obj.id];\n    }\n\n    var r1;\n\n    for(var i in obj[propName]){\n\n        //RUN TEST\n        r1 = fn(obj[propName][i]);\n\n        if(r1 !== false){\n        //MATCH RETURNED. RECURSE INTO MATCH IF HAS PROPERTY OF SAME NAME TO SEARCH\n            //CHECK THAT WE AREN'T CAUGHT IN A CIRCULAR LOOP\n            if(breadcrumb.indexOf(r1) !== -1){\n                return public.debug([\n                    \"Circular condition in recursive search of obj property '\"\n                        +propName+\"' of object \"\n                        +((typeof obj.id !== 'undefined') ? \"'\"+obj.id+\"'\" : '')\n                        +\". Offending value: \"+r1\n                    ,(function(){\n                        breadcrumb.push(r1);\n                        return breadcrumb.join(\" [depends on]=> \");\n                    })()\n                ]);\n            }\n\n            breadcrumb.push(r1);\n\n            if(obj[propName][i][propName]){\n                return private.deferred.search_obj_recursively(obj[propName][i],propName,fn,breadcrumb);\n            }\n\n            break;\n        }\n\n    }\n\n    return breadcrumb;\n};\n    \n    \n/**\n * Converts a promise description into a promise.\n * \n * @param {type} obj\n * @returns {undefined}\n */\nprivate.deferred.convert_to_promise = function(obj){\n\n    //IF ALREADY EXISTS, RETURN EXISTING\n    if(!obj.id){\n\n        if(obj.type === 'timer'){\n            obj.id = \"timer-\" + obj.timeout + \"-\"+public.i++;\n        }\n        else if(typeof obj.url === 'string'){\n            obj.id = obj.url.split(\"/\").pop();\n            //REMOVE .js FROM ID\n            if(obj.id.search(\".js\")!== -1){\n                obj.id = obj.id.split(\".\");\n                obj.id.pop();\n                obj.id = obj.id.join(\".\");\n            }\n        }\n        else{\n            return public.debug([\n                \"Dependencies without a 'url' property require 'id' property be set.\"\n                ,\"'\"+obj.type+\"' id undefined.\"\n                ,obj\n            ]);\n        }\n    }\n\n    if(obj.type !== 'timer'){\n        //RETURN THE PROMISE IF IT ALREADY EXISTS\n        if(typeof public.list[obj.id] !== 'undefined'){\n          //A previous promise of the same id exists. \n          //Make sure this dependency object doesn't have a\n          //resolver - if it does error\n          if(obj.resolver){\n            public.debug([\n              \"You can't set a resolver on a queue that has already been declared. You can only reference the original.\"\n              ,\"Detected re-init of '\" + obj.id + \"'.\"\n              ,\"Attempted:\"\n              ,obj\n              ,\"Existing:\"\n              ,public.list[obj.id]\n            ]);\n          }\n          else{\n            return public.list[obj.id];\n          }\n        }\n    }\n\n    //CONVERT DEPENDENCY TO PROMISE\n    var prom;\n    switch(true){\n\n        //EVENT\n        case(obj.type === 'event'):\n            prom = private.deferred._wrap_event(obj);\n            break;\n\n        //ALREADY A PROMISE\n        case(obj.type === 'deferred'):\n        case(obj.type === 'promise' || obj.then):   \n\n            switch(true){\n\n                //OBJECT IS A REFERENCE TO A PROMISE\n                case(typeof obj.id === 'string'):\n                    console.warn(\"Promise '\"+obj.id +\"': did not exist. Auto creating new deferred.\");\n                    prom = public.deferred({\n                        id : obj.id\n                    });\n                    break;\n\n                //OBJECT PROPERTY .promise EXPECTED TO RETURN A PROMISE\n                case(typeof obj.promise === 'function'):\n                    if(obj.scope){\n                        prom = obj.promise.call(obj.scope);\n                    }\n                    else{\n                        prom = obj.promise();\n                    }\n                    break;\n\n                //OBJECT IS A PROMISE\n                case(obj.then):\n                    prom = obj;\n                    break;\n\n                default:\n\n            }\n\n            //MAKE SURE IS PROMISE\n            if(typeof prom !== 'object' || !prom.then){\n                return public.debug(\"Dependency labeled as a promise did not return a promise.\",obj);\n            }\n            break;\n\n        case(obj.type === 'timer'):\n            prom = private.deferred._wrap_timer(obj);\n            break;\n\n        //XHR\n        default:\n            obj.type = obj.type || \"default\";\n            prom = private.deferred._wrap_xhr(obj);\n    }\n\n    //INDEX PROMISE BY ID FOR FUTURE REFERENCING\n    public.list[obj.id] = prom;\n\n    return prom;\n};\n    \n    \n/**\n * Converts a reference to a DOM event to a promise.\n * Resolved on first event trigger.\n * \n * @todo remove jquery dependency\n * \n * @param {object} obj\n * @returns {object} deferred object\n */\nprivate.deferred._wrap_event = function(obj){\n\n    var def = public.deferred({\n        id : obj.id\n    });\n\n    //BROWSER\n    if(typeof document !== 'undefined' && typeof window !== 'undefined'){\n\n        if(typeof $ !== 'function'){\n            var msg = 'window and document based events depend on jQuery';\n            def.reject(msg);\n        }\n        else{\n            //For now, depend on jquery for IE8 DOMContentLoaded polyfill\n            switch(true){\n                case(obj.id === 'ready' || obj.id === 'DOMContentLoaded'):\n                    $(document).ready(function(){\n                        def.resolve(1);\n                    });\n                    break;\n                case(obj.id === 'load'):\n                    $(window).load(function(){\n                        def.resolve(1);\n                    });\n                    break;\n                default:\n                    $(document).on(obj.id,\"body\",function(){\n                        def.resolve(1);\n                    });\n            }\n        }\n    }\n\n    return def;\n};\n    \n\nprivate.deferred._wrap_timer = function(obj){\n\n    var prom = public.deferred(obj);\n\n    (function(prom){\n\n        var _start = new Date().getTime();      \n        setTimeout(function(){\n            var _end = new Date().getTime();\n            prom.resolve({\n                start : _start\n                ,end : _end\n                ,elapsed : _end - _start\n                ,timeout : obj.timeout\n            });\n        },obj.timeout);\n\n    }(prom));\n\n    return prom;\n};\n    \n    \n/**\n * Creates a deferred object that depends on the loading of a file.\n * \n * @param {object} dep\n * @returns {object} deferred object\n */\nprivate.deferred._wrap_xhr = function(dep){\n\n\n    var required = [\"id\",\"url\"];\n    for(var i in required){\n        if(!dep[required[i]]){\n            return public.debug([\n                \"File requests converted to promises require: \" + required[i]\n                ,\"Make sure you weren't expecting dependency to already have been resolved upstream.\"\n                ,dep\n            ]\n            );\n        }\n    }\n\n\n    //IF PROMISE FOR THIS URL ALREADY EXISTS, RETURN IT\n    if(public.list[dep.id]){\n        return public.list[dep.id];\n    }\n\n\n    //CONVERT TO DEFERRED:\n    var deferred;\n    deferred = public.deferred(dep);\n    deferred = private.deferred.attach_xhr(deferred,dep);\n    return deferred;\n};\n    \n    \n/**\n *    \n * \n * @param {type} deferred\n * @param {type} dep\n * \n * dep:\n * =========\n *                  \n * <fs> boolean. Filesystem. Whether to loda the file from server filesytem or via http server\n *                  \n * @returns {unresolved}\n */\nprivate.deferred.attach_xhr = function(deferred,dep){\n\n    //GET AUTOPATH\n    if(dep.url[0] === \"*\"){\n\n        var autopath = Orgy.config().autopath;\n\n        if(typeof autopath !== 'string'){\n            public.debug([\n                    \"config.autopath must be set to a string.\"\n                ]\n                ,[\n                    \"When a dependency url begins with *, it is replaced by the config property 'autopath'.\"\n            ]);\n        }\n        else{\n            dep.url = dep.url.replace(/\\*/,autopath);\n        }\n    }\n\n\n    //BROWSER\n    if(typeof process !== 'object' || process + '' !== '[object process]'){\n\n        this.head = this.head || document.getElementsByTagName(\"head\")[0] || document.documentElement;\n\n        switch(true){\n\n            case(dep.type==='script'):\n\n                var node = document.createElement(\"script\");\n                node.type = 'text/javascript';\n                node.setAttribute(\"src\",dep.url);\n                node.setAttribute(\"id\",dep.id);\n\n                (function(node,dep,deferred){\n\n                    node.onload = node.onreadystatechange = function(){\n                        //Do not autoresolve modules, which are\n                        //self-resolved via Orgy.export\n                        if(!deferred._is_orgy_module){\n                            deferred.resolve((typeof node.value !== 'undefined') ? node.value : node);\n                        }\n                    };\n                    node.onerror = function(){\n                        deferred.reject(\"Error loading: \" + dep.url);\n                    };\n                }(node,dep,deferred));\n\n                //put scripts before <base> elements, after <meta>\n                this.head.appendChild(node);\n                break;\n\n            case(dep.type==='css' || dep.type==='link'):\n\n                var node = document.createElement(\"link\");\n                node.setAttribute(\"href\",dep.url);\n                node.setAttribute(\"type\",\"text/css\");\n                node.setAttribute(\"rel\",\"stylesheet\");\n\n                if(node.onload){\n                    (function(node,dep,deferred){\n                        node.onload = node.onreadystatechange = function(){\n                           deferred.resolve(node);\n                       };\n\n                       node.onerror = function(){\n                           deferred.reeject(\"Failed to load path: \" + dep.url);\n                       };\n\n                    }(node,dep,deferred));\n\n                    this.head.appendChild(node);\n                    break;\n                }\n                else{\n                    //ADD NODE BUT MAKE XHR REQUEST TO CHECK FILE RECEIVED\n                    this.head.appendChild(node);\n                }\n\n            case(dep.type==='json'):\n            default:\n\n                var r;\n                var req = new XMLHttpRequest();\n                req.open('GET', dep.url, true);\n\n                if(typeof dep.show_messages !== 'undefined'){\n                    req.setRequestHeader('show-messages', dep.show_messages);\n                }\n                if(typeof dep.return_packet !== 'undefined'){\n                    req.setRequestHeader('return-packet', dep.return_packet);\n                }\n\n                (function(dep,deferred){\n                    req.onreadystatechange = function() {\n                        if (req.readyState === 4) {\n                            if(req.status === 200){\n                                r = req.responseText;\n                                if(dep.type === 'json'){\n                                    try{\n                                        r = JSON.parse(r);\n                                    }\n                                    catch(e){\n                                        public.debug([\n                                            \"Could not decode JSON\"\n                                            ,dep.url\n                                            ,r\n                                        ],deferred);\n                                    }\n                                }\n                                //WE WANT TO RESOLVE WITH DOM NODE FOR CSS FILES\n                                deferred.resolve(node || r);\n                            }\n                            else{\n                                deferred.reject(\"Error loading: \" + dep.url);\n                            }\n                        }\n                    };\n                }(dep,deferred));\n\n                req.send(null);\n        }\n    }\n    //NODEJS\n    else{\n\n        function process_result(deferred,data,dep){\n\n            switch(true){\n\n                case(dep.type === 'json'):\n                    data = JSON.parse(data);\n                    deferred.resolve(data);\n                    break;\n\n                default:\n                    deferred.resolve(data);\n\n            }\n        }     \n\n        if(dep.remote){\n            var request = require('request');\n            request.get(dep.url, function (error, response, body) {\n                if (!error && response.statusCode == 200) {\n                    process_result(deferred,body,dep);\n                };\n            });\n\n        }\n        else{\n\n            //DON'T GET SCRIPTS AS TEXT\n            if(dep.type === 'script'){\n                var data = require(dep.url);\n\n                if(!deferred._is_orgy_module){\n                    deferred.resolve(data);\n                }\n            }\n            //DON'T GET CSS, JUST ADD NODE\n            else if(dep.type === 'css'){\n\n                if(private.config.document !== null){\n                    var node = private.config.document('head').append('<link rel=\"stylesheet\" href=\"'+dep.url+'\" type=\"text/css\" />');\n                    deferred.resolve(node);\n                }\n                else{\n                    return public.debug([\n                        dep.url\n                        ,\"Must pass html document to Orgy.config() before attempting to add DOM nodes [i.e. css] as dependencies.\"\n                    ],deferred);\n                }\n            }\n            else{\n\n                var fs = require('fs');\n\n                (function(deferred,dep){\n\n                    fs.readFile(dep.url, 'utf8', function (err, data) {\n\n                        if (err){\n                            public.debug([\n                                \"File \" + dep.url + \" not found @ local dep.url '\" + dep.url +\"'\"\n                                ,\"CWD: \"+process.cwd()\n                            ],deferred);\n                            \n                            process.exit();\n                        }\n\n                        process_result(deferred,data,dep);\n                    });\n\n                }(deferred,dep));\n\n            }\n        }\n    }\n\n    return deferred;\n};","/**\n * Default properties for all deferred objects.\n * \n */\n\n//////////////////////////////////////////\n//  PUBLIC VARIABLES\n//////////////////////////////////////////\n\n\n//////////////////////////////////////////\n//  PRIVATE VARIABLES\n//////////////////////////////////////////\n\n\nprivate.deferred.tpl = {};\n\nprivate.deferred.tpl.id = null;\n\n//A COUNTER FOR AUT0-GENERATED PROMISE ID'S\nprivate.deferred.tpl.settled = 0;\n\n/**\n * STATE CODES:\n * ------------------\n * -1   => SETTLING [EXECUTING CALLBACKS]\n *  0   => PENDING\n *  1   => RESOLVED / FULFILLED\n *  2   => REJECTED \n */\nprivate.deferred.tpl.state = 0;\n\nprivate.deferred.tpl.value = [];\n\n//The most recent value generated by the then->done chain. \nprivate.deferred.tpl.caboose = null;\n\nprivate.deferred.tpl.model = \"deferred\";\n\nprivate.deferred.tpl.done_fired = 0;\n\nprivate.deferred.tpl._is_orgy_module = 0;\n\nprivate.deferred.tpl.timeout_id = null;\n\nprivate.deferred.tpl.callback_states = {\n    resolve : 0\n    ,then : 0\n    ,done : 0\n    ,reject : 0\n};\n\n/**\n * Self executing function to initialize callback event\n * list.\n * \n * Returns an object with the same propertyNames as \n * private.deferred.tpl.callback_states: adding boilerplate\n * properties for each\n * \n * @returns {object}\n */\nprivate.deferred.tpl.callbacks = (function(){\n    \n    var o = {};\n    \n    for(var i in private.deferred.tpl.callback_states){\n        o[i] = {\n            train : []\n            ,hooks : {\n                onBefore : {\n                    train : []\n                }\n                ,onComplete : {\n                    train : []\n                }\n            }\n        };\n    }\n    \n    return o;\n})();\n    \n//PROMISE HAS OBSERVERS BUT DOES NOT OBSERVE OTHERS\nprivate.deferred.tpl.downstream = {};\n\nprivate.deferred.tpl.execution_history = [];\n\n//WHEN TRUE, ALLOWS RE-INIT [FOR UPGRADES TO A QUEUE]          \nprivate.deferred.tpl.overwritable = 0; \n\n//Default timeout for a deferred\nprivate.deferred.tpl.timeout = 5000;\n\n/**\n * REMOTE\n * \n * REMOTE == 1  =>  [DEFAULT] Make http request for file\n * \n * REMOTE == 0  =>  Read file directly from the filesystem\n * \n * ONLY APPLIES TO SCRIPTS RUN UNDER NODE AS BROWSER HAS NO \n * FILESYSTEM ACCESS\n */\nprivate.deferred.tpl.remote = 1;\n\n//ADDS TO MASTER LIST. ALWAYS TRUE UNLESS UPGRADING A PROMISE TO A QUEUE\nprivate.deferred.tpl.list = 1;\n\n\n//////////////////////////////////////////\n//  PUBLIC METHODS\n//////////////////////////////////////////\n\n\n/**\n * Resolves a deferred.\n * \n * @param {mixed} value\n * @returns {void}\n */\nprivate.deferred.tpl.resolve = function(value){\n\n    if(this.settled === 1){\n        public.debug([\n            this.id + \" can't resolve.\"\n            ,\"Only unsettled deferreds are resolvable.\"\n        ]);\n    }\n\n    //SET STATE TO SETTLEMENT IN PROGRESS\n    private.deferred.set_state(this,-1);\n\n    //SET VALUE\n    this.value = value;\n\n    //RUN RESOLVER BEFORE PROCEEDING\n    //EVEN IF THERE IS NO RESOLVER, SET IT TO FIRED WHEN CALLED\n    if(!this.resolver_fired && typeof this.resolver === 'function'){\n        \n        this.resolver_fired = 1;   \n        \n        //Add resolver to resolve train\n        this.callbacks.resolve.train.push(function(){\n            this.resolver(value,this);\n        });\n    }\n    else{\n        \n        this.resolver_fired = 1;  \n        \n        //Add settle to resolve train\n        //Always settle before all other complete callbacks\n        this.callbacks.resolve.hooks.onComplete.train.unshift(function(){\n            private.deferred.settle(this);\n        });\n    }\n\n    //Run resolve [standard respect for any hooks]\n    private.deferred.run_train(\n        this\n        ,this.callbacks.resolve\n        ,this.value\n        ,{pause_on_deferred : false}\n    );\n\n    //resolver is expected to call resolve again\n    //and that will get us past this point\n    return this;\n};\n\n\nprivate.deferred.tpl.reject = function(err){\n\n    if(!(err instanceof Array)){\n        err = [err];\n    }\n\n    err.unshift(\"REJECTED \"+this.model+\": '\"+this.id+\"'\");\n\n    //@todo reconsider this\n    public.debug(err,this);\n\n    //Remove auto timeout timer\n    if(this.timeout_id){\n        clearTimeout(this.timeout_id);\n    }\n\n    //Set state to rejected\n    private.deferred.set_state(this,2);\n\n    //Execute rejection queue\n    private.deferred.run_train(\n        this\n        ,this.callbacks.reject\n        ,err\n        ,{pause_on_deferred : false}\n    );\n\n    return this;\n};\n\n\nprivate.deferred.tpl.then = function(fn,rejector){\n\n    switch(true){\n\n        //An error was previously thrown, bail out\n        case(this.state === 2):\n            break;\n\n        //Execution chain already finished. Bail out.\n        case(this.done_fired === 1):\n            return public.debug(this.id+\" can't attach .then() because .done() has already fired, and that means the execution chain is complete.\");\n            break;\n\n        default:\n\n            //Push callback to then queue\n            this.callbacks.then.train.push(fn);\n\n            //Push reject callback to the rejection queue\n            if(typeof rejector === 'function'){\n                this.callbacks.reject.train.push(rejector);\n            }\n            \n            //Settled, run train now\n            if(this.settled === 1 && this.state === 1 && !this.done_fired){        \n                private.deferred.run_train(\n                    this\n                    ,this.callbacks.then\n                    ,this.caboose\n                    ,{pause_on_deferred : true}\n                );\n            }\n            //Unsettled, train will be run when settled\n            else{}\n    }\n\n    return this;\n};\n\n\nprivate.deferred.tpl.done = function(fn){\n\n    if(this.callbacks.done.train.length === 0\n       && this.done_fired === 0){\n        if(typeof fn === 'function'){\n            \n            //wrap callback with some other commands\n            var fn2 = function(r,deferred,last){\n              \n                //Done can only be called once, so note that it has been\n                deferred.done_fired = 1;\n                \n                fn(r,deferred,last);\n            };\n\n            this.callbacks.done.train.push(fn2);\n            \n            //Settled, run train now\n            if(this.settled === 1 && this.state === 1){     \n                private.deferred.run_train(\n                    this\n                    ,this.callbacks.done\n                    ,this.caboose\n                    ,{pause_on_deferred : false}\n                );\n            }\n            //Unsettled, train will be run when settled\n            else{}\n        }\n        else{\n            return public.debug(\"done() must be passed a function.\");\n        }\n    }\n    else{\n        return public.debug(\"done() can only be called once.\");\n    }\n};","public.queue = {};\nprivate.queue = {};\n\n\n//////////////////////////////////////////\n//  PUBLIC VARIABLES\n//////////////////////////////////////////\n\n\n//////////////////////////////////////////\n//  PRIVATE VARIABLES\n//////////////////////////////////////////\n\n\n/**\n* Template object for all queues\n* \n* @type object\n*/\nprivate.queue.tpl = {\n\n   model : 'queue'\n\n\n   //SET TRUE AFTER RESOLVER FIRED\n   ,resolver_fired : 0\n\n\n   //PREVENTS A QUEUE FROM RESOLVING EVEN IF ALL DEPENDENCIES MET\n   //PURPOSE: PREVENTS QUEUES CREATED BY ASSIGNMENT FROM RESOLVING \n   //BEFORE THEY ARE FORMALLY INSTANTIATED\n   ,halt_resolution : 0\n\n\n   //USED TO CHECK STATE, ENSURES ONE COPY\n   ,upstream : {}\n\n\n   //USED RETURN VALUES, ENSURES ORDER\n   ,dependencies : []\n\n\n   ///////////////////////////////////////////////////\n   //  QUEUE INSTANCE METHODS\n   ///////////////////////////////////////////////////\n\n\n   /**\n    * Add list of dependencies to a queue's upstream array.\n    * \n    * The queue will resolve once all the promises in its \n    * upstream array are resolved.\n    * \n    * When public.config.debug == 1, method will test each \n    * dependency is not previously scheduled to resolve \n    * downstream from the target, in which \n    * case it would never resolve because its upstream depends on it.\n    * \n    * @param {array} arr  /array of dependencies to add\n    * @returns {array} upstream\n    */\n   ,add : function(arr){\n\n       try{\n           if(arr.length === 0) return this.upstream;\n       }\n       catch(err){\n           public.debug(err);\n       }\n\n       //IF NOT PENDING, DO NOT ALLOW TO ADD\n       if(this.state !== 0){\n           return public.debug(\"Cannot add list to queue id:'\"+this.id\n           +\"'. Queue settled/in the process of being settled.\",this);\n       }\n\n       for(var a in arr){\n\n           switch(true){\n\n               //CHECK IF EXISTING PROMISE\n               case(typeof public.list[arr[a]['id']] === 'object'):\n                   arr[a] = public.list[arr[a]['id']];\n                   break;\n\n               //IF NOT, ATTEMPT TO CONVERT IT TO A PROMISE\n               case(typeof arr[a] === 'object' && typeof arr[a].then !== 'function'):\n                   arr[a] = private.deferred.convert_to_promise(arr[a]);\n                   break;\n\n               //REF IS A PROMISE.\n               case(typeof arr[a].then === 'function'):\n                   break;\n\n               default:\n                   console.error(\"Object could not be converted to promise.\");\n                   console.error(arr[a]);\n                   debugger;\n                   continue;\n           }\n\n           //must check the target to see if the dependency exists in its downstream\n           for(var b in this.downstream){\n               if(b === arr[a].id){\n                   return public.debug(\"Error adding upstream dependency '\"+arr[a].id+\"' to queue\"+\" '\"+this.id+\"'.\\n Promise object for '\"+arr[a].id+\"' is scheduled to resolve downstream from queue '\"+this.id+\"' so it can't be added upstream.\");\n               }\n           }\n\n           //ADD TO UPSTREAM, DOWNSTREAM, DEPENDENCIES\n           this.upstream[arr[a].id] = arr[a];\n           arr[a].downstream[this.id] = this;\n           this.dependencies.push(arr[a]);\n\n       }\n\n       return this.upstream;\n   }\n\n\n   /**\n    * Remove list from a queue.\n    * \n    * @param {array} arr\n    * @returns {array} array of list the queue is upstream\n    */\n   ,remove : function(arr){\n\n       //IF NOT PENDING, DO NOT ALLOW REMOVAL\n       if(this.state !== 0){\n           return public.debug(\"Cannot remove list from queue id:'\"+this.id+\"'. Queue settled/in the process of being settled.\");\n       }\n\n       for(var a in arr){\n           if(this.upstream[arr[a].id]){\n               delete this.upstream[arr[a].id];\n               delete arr[a].downstream[this.id];\n           }\n       }\n   }\n\n\n  /**\n   * Resets an existing,settled queue back to Orgying state.\n   * Clears out the downstream.\n   * Fails if not settled.\n   * @param {object} options\n   * @returns {private.queue.tpl|Boolean}\n   */\n   ,reset : function(options){\n\n       if(this.settled !== 1 || this.state !== 1){\n           return public.debug(\"Can only reset a queue settled without errors.\");\n       }\n\n       options = options || {};\n\n       this.settled = 0;\n       this.state = 0; \n       this.resolver_fired = 0;\n       this.done_fired = 0;\n\n       //REMOVE AUTO TIMEOUT TIMER\n       if(this.timeout_id){\n           clearTimeout(this.timeout_id);\n       }\n\n       //CLEAR OUT THE DOWNSTREAM\n       this.downstream = {};\n       this.dependencies = [];\n\n       //SET NEW AUTO TIMEOUT\n       private.deferred.auto_timeout.call(this,options.timeout);\n\n       //POINTLESS - WILL JUST IMMEDIATELY RESOLVE SELF\n       //this.check_self()\n\n       return this;\n   }\n\n\n   /**\n    * Cauaes a queue to look over its dependencies and see if it \n    * can be resolved.\n    * \n    * This is done automatically by each dependency that loads,\n    * so is not needed unless:\n    * \n    * -debugging\n    * \n    * -the queue has been reset and no new\n    * dependencies were since added.\n    * \n    * @returns {int} State of the queue.\n    */\n   ,check_self : function(){\n       private.queue.receive_signal(this,this.id);\n       return this.state;\n   }\n};\n\n\n//////////////////////////////////////////\n//  PUBLIC METHODS\n//////////////////////////////////////////\n\n\npublic.queue = function(deps,options){\n\n    var _o;\n    if(!(deps instanceof Array)){\n        return public.debug(\"Queue dependencies must be an array.\");\n    }\n    \n    options = options || {};\n    \n    //DOES NOT ALREADY EXIST\n    if(!public.list[options.id]){\n        \n        //CREATE NEW QUEUE OBJECT\n        var _o = private.queue.factory(options);\n\n        //ACTIVATE QUEUE\n        _o = private.queue.activate(_o,options,deps);\n\n    }\n    //ALREADY EXISTS\n    else {\n        \n        _o = public.list[options.id];\n        \n        if(_o.model !== 'queue'){\n        //MATCH FOUND BUT NOT A QUEUE, UPGRADE TO ONE\n\n            options.overwritable = 1;\n\n            _o = private.queue.upgrade(_o,options,deps);\n        }\n        else{\n            \n            //OVERWRITE ANY EXISTING OPTIONS\n            for(var i in options){\n                _o[i] = options[i];\n            }\n            \n            //ADD ADDITIONAL DEPENDENCIES IF NOT RESOLVED\n            if(deps.length > 0){\n                private.queue.tpl.add.call(_o,deps);\n            }\n            \n        }\n        \n        //RESUME RESOLUTION UNLESS SPECIFIED OTHERWISE\n        _o.halt_resolution = (typeof options.halt_resolution !== 'undefined') ?\n        options.halt_resolution : 0;\n    }\n    \n    return _o;\n};\n\n\n//////////////////////////////////////////\n//  PRIVATE METHODS\n//////////////////////////////////////////\n\n\nprivate.queue.factory = function(options){\n\n    //CREATE A NEW QUEUE OBJECT\n    var _o = public.naive_cloner([\n        private.deferred.tpl\n        ,private.queue.tpl\n        ,options\n    ]);\n\n    //Save backtrace for async debugging\n    _o.origin_stack = private.origin_stack('public.queue');\n    \n    //if no id, use origin\n    if(!options.id){\n        _o.id = _o.origin_stack[_o.origin_stack.length -1];\n    }\n    \n    return _o;\n};    \n    \n    \n/**\n * Activates a queue object.\n * \n * @param {object} o\n * @param {object} options\n * @param {array} deps\n * @returns {object} queue\n */\nprivate.queue.activate = function(o,options,deps){\n\n    //ACTIVATE AS A DEFERRED\n    o = private.deferred.activate(o);\n\n    //ADD ANY DEFERREDS TO QUEUE\n    private.queue.tpl.add.call(o,deps);\n\n    //SEE IF CAN BE IMMEDIATELY RESOLVED BY CHECKING UPSTREAM\n    private.queue.receive_signal(o,o.id);\n\n    //ASSIGN THIS QUEUE UPSTREAM TO OTHER QUEUES\n    if(o.assign){\n        for(var a in o.assign){\n            public.assign(o.assign[a],[o],true);\n        }\n    }\n\n    return o;\n};\n    \n    \n/**\n* A \"signal\" here causes a queue to look through each item \n* in its upstream and check to see if all are resolved. \n* \n* Signals can only be received by a queue itself or an instance\n* in its upstream.\n* \n* @param {object} target\n* @param {string} from_id\n* @returns {void}\n*/\nprivate.queue.receive_signal = function(target,from_id){\n\n    if(target.halt_resolution === 1) return;\n\n   //MAKE SURE THE SIGNAL WAS FROM A PROMISE BEING LISTENED TO\n   //BUT ALLOW SELF STATUS CHECK\n   if(from_id !== target.id && !target.upstream[from_id]){\n       return public.debug(from_id + \" can't signal \" + target.id + \" because not in upstream.\");\n   }\n   //RUN THROUGH QUEUE OF OBSERVING PROMISES TO SEE IF ALL DONE\n   else{\n       var status = 1;\n       for(var i in target.upstream){\n           //SETS STATUS TO 0 IF ANY OBSERVING HAVE FAILED, BUT NOT IF PENDING OR RESOLVED\n           if(target.upstream[i].state !== 1) {\n               status = target.upstream[i].state;\n               break;\n           }\n       }\n   }\n\n   //RESOLVE QUEUE IF UPSTREAM FINISHED\n   if(status === 1){\n\n        //GET RETURN VALUES PER DEPENDENCIES, WHICH SAVES ORDER AND \n        //REPORTS DUPLICATES\n        var values = [];\n        for(var i in target.dependencies){\n            values.push(target.dependencies[i].value);\n        }\n\n        private.deferred.tpl.resolve.call(target,values);\n   }\n\n   if(status === 2){\n       var err = [\n           target.id+\" dependency '\"+target.upstream[i].id + \"' was rejected.\"\n           ,target.upstream[i].arguments\n       ];\n       private.deferred.tpl.reject.apply(target,err);\n   }\n};\n\n\n/**\n* Upgrades a promise object to a queue.\n* \n* @param {object} obj\n* @param {object} options\n* @param {array} deps \\dependencies\n* @returns {object} queue object\n*/\nprivate.queue.upgrade = function(obj,options,deps){\n\n    if(obj.settled !== 0 || (obj.model !== 'promise' && obj.model !== 'deferred')){\n        return public.debug('Can only upgrade unsettled promise or deferred into a queue.');\n    }\n\n   //GET A NEW QUEUE OBJECT AND MERGE IN\n    var _o = public.naive_cloner([\n        private.queue.tpl\n        ,options\n    ]);\n\n    for(var i in _o){\n       obj[i] = _o[i];\n    }\n\n    delete _o;\n\n    //CREATE NEW INSTANCE OF QUEUE\n    obj = private.queue.activate(obj,options,deps);\n\n    //RETURN QUEUE OBJECT\n    return obj;\n};","////////////////////////////////////////\n//  PUBLIC METHODS\n////////////////////////////////////////\n\n\n/**\n * Casts an object into an Orgy deferred.\n * \n * > Object to be casted must have the following properties:\n *  - then()\n *  - error() \n * \n * > If the casted object has an id or url property set, the id or url\n * [in that order] will become the id of the deferred for referencing\n * with Orgy.get(id)\n *  \n * @param {object} obj  /thenable\n * @returns {object}\n */\npublic.cast = function(obj){\n            \n    var required = [\"then\",\"error\"];\n    for(var i in required){\n        if(!obj[required[i]]){\n            return public.debug(\"Castable objects require: \" \n                + required[i]);\n        }\n    }\n\n    var options = {};\n    if(obj.id){\n        options.id = obj.id;\n    }\n    else if(obj.url){\n        options.id = obj.url;\n    }\n    \n    //Create a deferred\n    var def = public.deferred(options);\n\n    //Set then, rejector\n    def.then(function(r){\ndebugger;\n        obj.then(r);\n    },function(r){\ndebugger;\n        obj.error(r);\n    });\n\n    //Return deferred\n    return def;\n};      ","if(typeof process === 'object' && process + '' === '[object process]'){\n    // is node\n    module.exports = public;\n}\nelse{\n    // not node\n    Orgy = public;\n}"]}